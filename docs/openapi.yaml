openapi: 3.0.0
info:
  title: UC-Cloud Ops-Center API
  version: 2.1.0
  description: |
    Comprehensive API documentation for UC-Cloud Operations Center.

    ## Features
    - **User Management**: Keycloak SSO integration for user authentication and authorization
    - **Organization Management**: Multi-tenant organization and team management
    - **Billing & Subscriptions**: Lago billing integration with Stripe payments
    - **LLM Infrastructure**: LiteLLM proxy for multi-provider LLM access
    - **Service Management**: Docker service orchestration and monitoring
    - **Analytics & Monitoring**: Real-time metrics, usage tracking, and reporting
    - **Traefik Management**: Dynamic routing, SSL/TLS, and load balancing
    - **Storage & Backup**: Restic-based backup management

    ## Authentication
    All endpoints require JWT Bearer token authentication via Keycloak SSO.

    ## Rate Limiting
    API endpoints are rate-limited based on subscription tier:
    - Trial: 100 requests/day
    - Starter: 1,000 requests/month
    - Professional: 10,000 requests/month
    - Enterprise: Unlimited

  contact:
    name: UC-Cloud Support
    url: https://your-domain.com
    email: support@magicunicorn.tech
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://your-domain.com
    description: Production server
  - url: http://localhost:8084
    description: Development server

security:
  - BearerAuth: []

tags:
  - name: Email Notifications
    description: Email Notifications operations
  - name: LLM
    description: Llm operations
  - name: LLM Configuration
    description: Llm Configuration operations
  - name: LLM Management
    description: Llm Management operations
  - name: LLM Providers
    description: Llm Providers operations
  - name: Local Users
    description: Local Users operations
  - name: Platform Settings
    description: Platform Settings operations
  - name: Storage & Backup
    description: Storage & Backup operations
  - name: System Settings
    description: System Settings operations
  - name: Traefik Metrics
    description: Traefik Metrics operations
  - name: Traefik Middlewares
    description: Traefik Middlewares operations
  - name: Traefik Routes
    description: Traefik Routes operations
  - name: Traefik Services
    description: Traefik Services operations
  - name: admin
    description: Admin operations
  - name: billing
    description: Billing operations
  - name: billing-lago
    description: Billing-Lago operations
  - name: byok
    description: Byok operations
  - name: cloudflare
    description: Cloudflare operations
  - name: credentials
    description: Credentials operations
  - name: credits
    description: Credits operations
  - name: execution-servers
    description: Execution-Servers operations
  - name: keycloak-status
    description: Keycloak-Status operations
  - name: migration
    description: Migration operations
  - name: network
    description: Network operations
  - name: organizations
    description: Organizations operations
  - name: subscriptions
    description: Subscriptions operations
  - name: system-metrics
    description: System-Metrics operations
  - name: tier-check
    description: Tier-Check operations
  - name: traefik
    description: Traefik operations
  - name: usage
    description: Usage operations

paths:
  /api/v1/admin/llm/providers/{provider_id}:
    get:
      summary: Get provider by ID
      operationId: get_provider
      tags:
        - LLM Providers
      description: |
        Get provider by ID
        
            Returns provider details with model count.
      parameters:
        - name: provider_id
          in: path
          required: true
          schema:
            type: string
          description: Provider Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update LLM provider
      operationId: update_provider
      tags:
        - LLM Providers
      description: |
        Update LLM provider
        
            Admin only. Updates provider configuration.
      parameters:
        - name: provider_id
          in: path
          required: true
          schema:
            type: string
          description: Provider Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete LLM provider
      operationId: delete_provider
      tags:
        - LLM Providers
      description: |
        Delete LLM provider
        
            Admin only. Deletes provider and all associated models.
            System providers cannot be deleted.
      parameters:
        - name: provider_id
          in: path
          required: true
          schema:
            type: string
          description: Provider Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/llm/providers/{provider_id}/health:
    get:
      summary: Check provider health status
      operationId: check_provider_health
      tags:
        - LLM Providers
      description: |
        Check provider health status
        
            Tests provider API endpoint and updates health status.
      parameters:
        - name: provider_id
          in: path
          required: true
          schema:
            type: string
          description: Provider Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/llm/providers/{provider_id}/test:
    post:
      summary: Test provider API connection with API key
      operationId: test_provider_connection
      tags:
        - LLM Providers
      description: |
        Test provider API connection with API key
        
            Admin only. Tests if provided API key works with provider.
            Does NOT store the key.
      parameters:
        - name: provider_id
          in: path
          required: true
          schema:
            type: string
          description: Provider Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/subscriptions/analytics/overview:
    get:
      summary: Get subscription analytics and revenue metrics
      operationId: get_subscription_analytics
      tags:
        - admin
      description: |
        Get subscription analytics and revenue metrics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/subscriptions/analytics/revenue-by-tier:
    get:
      summary: Get revenue breakdown by subscription tier
      operationId: get_revenue_by_tier
      tags:
        - admin
      description: |
        Get revenue breakdown by subscription tier
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/subscriptions/analytics/usage-stats:
    get:
      summary: Get detailed usage statistics
      operationId: get_usage_statistics
      tags:
        - admin
      description: |
        Get detailed usage statistics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/subscriptions/list:
    get:
      summary: List all user subscriptions with usage stats
      operationId: list_all_subscriptions
      tags:
        - admin
      description: |
        List all user subscriptions with usage stats
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/subscriptions/{email}:
    get:
      summary: Get detailed subscription info for a specific user
      operationId: get_user_subscription
      tags:
        - admin
      description: |
        Get detailed subscription info for a specific user
      parameters:
        - name: email
          in: path
          required: true
          schema:
            type: string
          description: Email
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    patch:
      summary: Manually update a user's subscription (for support cases)
      operationId: update_user_subscription
      tags:
        - admin
      description: |
        Manually update a user's subscription (for support cases)
      parameters:
        - name: email
          in: path
          required: true
          schema:
            type: string
          description: Email
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/subscriptions/{email}/reset-usage:
    post:
      summary: Reset a user's API usage counters
      operationId: reset_user_usage
      tags:
        - admin
      description: |
        Reset a user's API usage counters
      parameters:
        - name: email
          in: path
          required: true
          schema:
            type: string
          description: Email
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/system/local-users/groups:
    get:
      summary: List all available system groups
      operationId: list_groups
      tags:
        - Local Users
      description: |
        List all available system groups
        
            Admin only.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/system/local-users/health:
    get:
      summary: Health check endpoint
      operationId: health_check
      tags:
        - Local Users
      description: |
        Health check endpoint
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/system/local-users/{username}:
    get:
      summary: Get details for a specific local user
      operationId: get_local_user
      tags:
        - Local Users
      description: |
        Get details for a specific local user
        
            Admin only.
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update an existing local user
      operationId: update_local_user
      tags:
        - Local Users
      description: |
        Update an existing local user
        
            Can update: password, shell, groups, sudo permissions.
            Admin only. All changes are audited.
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a local user
      operationId: delete_local_user
      tags:
        - Local Users
      description: |
        Delete a local user
        
            Uses userdel command. Optionally removes home directory.
            Admin only. All deletions are audited.
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/system/local-users/{username}/password:
    post:
      summary: Reset user password
      operationId: reset_user_password
      tags:
        - Local Users
      description: |
        Reset user password
        
            If password not provided, generates a secure random password.
            Admin only. All password resets are audited.
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/system/local-users/{username}/ssh-keys:
    get:
      summary: List SSH public keys for a user
      operationId: list_ssh_keys
      tags:
        - Local Users
      description: |
        List SSH public keys for a user
        
            Reads from ~/.ssh/authorized_keys.
            Admin only.
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Add SSH public key for a user
      operationId: add_ssh_key
      tags:
        - Local Users
      description: |
        Add SSH public key for a user
        
            Appends to ~/.ssh/authorized_keys.
            Admin only. All key additions are audited.
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/system/local-users/{username}/ssh-keys/{key_id}:
    delete:
      summary: Remove SSH public key for a user
      operationId: remove_ssh_key
      tags:
        - Local Users
      description: |
        Remove SSH public key for a user
        
            Removes line from ~/.ssh/authorized_keys by line number.
            Admin only. All key removals are audited.
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
        - name: key_id
          in: path
          required: true
          schema:
            type: string
          description: Key Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/admin/system/local-users/{username}/sudo:
    put:
      summary: Manage sudo access for a user
      operationId: set_sudo_access
      tags:
        - Local Users
      description: |
        Manage sudo access for a user
        
            Adds/removes user from sudo/wheel group.
            Admin only. All sudo changes are audited.
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups:
    get:
      summary: List all backups with status
      operationId: list_backups
      tags:
        - Storage & Backup
      description: |
        List all backups with status
        
            Returns:
            - Backup configuration
            - Last and next backup times
            - List of all backups with metadata
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/config:
    get:
      summary: Get backup configuration
      operationId: get_backup_config
      tags:
        - Storage & Backup
      description: |
        Get backup configuration
        
            Returns:
            - Backup schedule (cron format)
            - Retention policy
            - Backup location
            - Include/exclude patterns
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update backup configuration
      operationId: update_backup_config
      tags:
        - Storage & Backup
      description: |
        Update backup configuration
        
            **Admin only** - Updates backup settings
        
            Configurable settings:
            - **backup_enabled**: Enable/disable automatic backups
            - **schedule**: Cron expression for backup schedule
            - **retention_days**: How many days to keep backups
            - **backup_location**: Where to store backups
            - **include_paths**: Paths to include in backups
            - **exclude_patterns**: File patterns to exclude
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/create:
    post:
      summary: Create a new backup
      operationId: create_backup
      tags:
        - Storage & Backup
      description: |
        Create a new backup
        
            **Admin only** - Triggers backup creation
        
            - **backup_type**: Type of backup (manual, scheduled, incremental)
            - **include_volumes**: Specific volumes to backup (None = all)
            - **description**: Optional description for the backup
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/check:
    post:
      summary: Test connection to remote
      operationId: check_rclone_connection
      tags:
        - Storage & Backup
      description: |
        Test connection to remote
        
            **Admin only** - Verifies remote is accessible
        
            Query Parameters:
            - **remote_name**: Name of configured remote to test
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/configure:
    post:
      summary: Configure a new rclone remote
      operationId: configure_rclone_remote
      tags:
        - Storage & Backup
      description: |
        Configure a new rclone remote
        
            **Admin only** - Configures cloud provider connection
        
            - **remote_name**: Name for the remote
            - **provider**: Provider type (s3, drive, dropbox, onedrive, etc.)
            - **config**: Provider-specific configuration parameters
            - **encrypt**: Whether to create encrypted remote wrapper
        
            Example for S3:
            ```json
            {
              "remote_name": "my-s3",
              "provider": "s3",
              "config": {
                "access_key_id": "...",
                "secret_access_key": "...",
                "region": "us-east-1",
                "endpoint": "s3.amazonaws.com"
              },
              "encrypt": false
            }
            ```
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/copy:
    post:
      summary: Copy files via rclone (doesn't delete from destination)
      operationId: rclone_copy
      tags:
        - Storage & Backup
      description: |
        Copy files via rclone (doesn't delete from destination)
        
            **Admin only** - Copies files without removing extra files at destination
        
            - **source**: Source path
            - **destination**: Destination path
            - **dry_run**: Preview changes
            - **checksum**: Use checksums
            - **bwlimit**: Bandwidth limit
            - **exclude**: Exclude patterns
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/delete:
    post:
      summary: Delete files at remote path
      operationId: rclone_delete
      tags:
        - Storage & Backup
      description: |
        Delete files at remote path
        
            **Admin only** - Permanently deletes files
        
            - **remote_path**: Path to delete (remote:path)
            - **dry_run**: Preview deletions without executing
        
            ⚠️ WARNING: This permanently deletes files!
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/list:
    get:
      summary: List files at remote path
      operationId: rclone_list
      tags:
        - Storage & Backup
      description: |
        List files at remote path
        
            **Admin only** - Lists files and directories
        
            Query Parameters:
            - **remote_path**: Path to list (e.g., "my-s3:backups/")
            - **recursive**: List subdirectories recursively
            - **max_depth**: Maximum directory depth (None = unlimited)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/mount:
    post:
      summary: Mount remote as local filesystem
      operationId: mount_rclone_remote
      tags:
        - Storage & Backup
      description: |
        Mount remote as local filesystem
        
            **Admin only** - Requires FUSE support
        
            - **remote_path**: Remote path to mount (remote:path)
            - **mount_point**: Local mount point directory
            - **read_only**: Mount as read-only
            - **allow_other**: Allow other users to access
        
            ⚠️ Note: Requires FUSE to be installed on the system
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/move:
    post:
      summary: Move files via rclone (deletes from source after copying)
      operationId: rclone_move
      tags:
        - Storage & Backup
      description: |
        Move files via rclone (deletes from source after copying)
        
            **Admin only** - Moves files and removes from source
        
            - **source**: Source path
            - **destination**: Destination path
            - **dry_run**: Preview changes
            - **delete_empty_src_dirs**: Delete empty source directories
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/providers:
    get:
      summary: List all supported cloud providers
      operationId: list_rclone_providers
      tags:
        - Storage & Backup
      description: |
        List all supported cloud providers
        
            Returns:
            - List of 40+ supported cloud storage providers
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/remotes:
    get:
      summary: List all configured rclone remotes
      operationId: list_rclone_remotes
      tags:
        - Storage & Backup
      description: |
        List all configured rclone remotes
        
            Returns:
            - List of configured remotes with type and encryption status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/size:
    get:
      summary: Get total size of remote path
      operationId: rclone_size
      tags:
        - Storage & Backup
      description: |
        Get total size of remote path
        
            **Admin only** - Calculates total size in bytes
        
            Query Parameters:
            - **remote_path**: Path to measure (e.g., "my-s3:backups/")
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/rclone/sync:
    post:
      summary: Sync directories via rclone (makes destination identical to source)
      operationId: rclone_sync
      tags:
        - Storage & Backup
      description: |
        Sync directories via rclone (makes destination identical to source)
        
            **Admin only** - Synchronizes files between local and cloud storage
        
            - **source**: Source path (local path or remote:path)
            - **destination**: Destination path (local path or remote:path)
            - **dry_run**: Preview changes without executing
            - **checksum**: Use checksums for verification
            - **bwlimit**: Bandwidth limit (e.g., "10M" for 10 MB/s)
            - **exclude**: List of file patterns to exclude
            - **delete_excluded**: Delete excluded files on destination
        
            Examples:
            - Local to cloud: `source="/data/backups", destination="my-s3:backups"`
            - Cloud to local: `source="my-s3:backups", destination="/data/restore"`
            - Cloud to cloud: `source="my-s3:data", destination="my-drive:data"`
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/verify/{backup_id}:
    post:
      summary: Verify backup integrity
      operationId: verify_backup
      tags:
        - Storage & Backup
      description: |
        Verify backup integrity
        
            Checks:
            - File existence and accessibility
            - Checksum validation
            - Archive integrity
            - Metadata consistency
      parameters:
        - name: backup_id
          in: path
          required: true
          schema:
            type: string
          description: Backup Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/{backup_id}:
    delete:
      summary: Delete a backup
      operationId: delete_backup
      tags:
        - Storage & Backup
      description: |
        Delete a backup
        
            **Admin only** - Permanently deletes a backup
        
            - **backup_id**: ID of backup to delete
      parameters:
        - name: backup_id
          in: path
          required: true
          schema:
            type: string
          description: Backup Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/{backup_id}/download:
    get:
      summary: Download a backup file
      operationId: download_backup
      tags:
        - Storage & Backup
      description: |
        Download a backup file
        
            **Admin only** - Downloads backup archive
        
            - **backup_id**: ID of backup to download
      parameters:
        - name: backup_id
          in: path
          required: true
          schema:
            type: string
          description: Backup Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/backups/{backup_id}/restore:
    post:
      summary: Restore from a backup
      operationId: restore_backup
      tags:
        - Storage & Backup
      description: |
        Restore from a backup
        
            **Admin only** - Restores system from backup
        
            - **backup_id**: ID of backup to restore
            - **restore_path**: Custom restore path (None = temp location)
            - **verify_before_restore**: Verify backup integrity before restoring
      parameters:
        - name: backup_id
          in: path
          required: true
          schema:
            type: string
          description: Backup Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/cycle:
    get:
      summary: Get current billing cycle information.
      operationId: get_billing_cycle
      tags:
        - billing-lago
      description: |
        Get current billing cycle information.
        
            Returns:
                Billing cycle dates and status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/download-invoice/{invoice_id}:
    post:
      summary: Generate download URL for invoice PDF.
      operationId: download_invoice
      tags:
        - billing-lago
      description: |
        Generate download URL for invoice PDF.
        
            Args:
                invoice_id: Lago invoice ID
        
            Returns:
                PDF download URL
      parameters:
        - name: invoice_id
          in: path
          required: true
          schema:
            type: string
          description: Invoice Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/invoices:
    get:
      summary: Get invoice history from Lago.
      operationId: get_invoices_list
      tags:
        - billing-lago
      description: |
        Get invoice history from Lago.
        
            Args:
                limit: Maximum number of invoices to return (default: 50)
        
            Returns:
                List of invoices with status, amount, and dates
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/payment-methods:
    get:
      summary: Get stored payment methods (Stripe).
      operationId: get_payment_methods
      tags:
        - billing-lago
      description: |
        Get stored payment methods (Stripe).
        
            Returns:
                List of payment methods
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    get:
      summary: Get user's saved payment methods
      operationId: get_payment_methods
      tags:
        - billing
      description: |
        Get user's saved payment methods
        
            Args:
                user_email: Current user's email (from auth dependency)
        
            Returns:
                List of payment methods
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/portal/create:
    post:
      summary: Create a Stripe Customer Portal session for subscription management
      operationId: create_portal_session
      tags:
        - billing
      description: |
        Create a Stripe Customer Portal session for subscription management
        
            Args:
                user_email: Current user's email (from auth dependency)
        
            Returns:
                Customer portal URL
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/subscription-status:
    get:
      summary: Get user's current subscription status
      operationId: get_subscription_status
      tags:
        - billing
      description: |
        Get user's current subscription status
        
            Args:
                user_email: Current user's email (from auth dependency)
        
            Returns:
                Subscription status information
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/subscription/cancel:
    post:
      summary: Cancel a subscription
      operationId: cancel_subscription
      tags:
        - billing
      description: |
        Cancel a subscription
        
            Args:
                request: Cancellation request
                user_email: Current user's email (from auth dependency)
        
            Returns:
                Success message
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/subscription/upgrade:
    post:
      summary: Upgrade or downgrade subscription tier
      operationId: upgrade_subscription
      tags:
        - billing
      description: |
        Upgrade or downgrade subscription tier
        
            Args:
                request: Upgrade request with new tier
                user_email: Current user's email (from auth dependency)
        
            Returns:
                Success message
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/subscriptions/checkout:
    post:
      summary: Create a Stripe Checkout session for subscription purchase
      operationId: create_checkout_session
      tags:
        - billing
      description: |
        Create a Stripe Checkout session for subscription purchase
        
            Args:
                request: Checkout session request with tier and billing cycle
                user_email: Current user's email (from auth dependency)
        
            Returns:
                Checkout session URL
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/summary:
    get:
      summary: Get billing summary with total spend, upcoming charges, etc.
      operationId: get_billing_summary
      tags:
        - billing-lago
      description: |
        Get billing summary with total spend, upcoming charges, etc.
        
            Returns:
                Billing summary statistics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/webhooks/stripe:
    post:
      summary: Handle Stripe webhook events
      operationId: stripe_webhook
      tags:
        - billing
      description: |
        Handle Stripe webhook events
        
            This endpoint is called by Stripe to notify about subscription events.
            It's exempt from CSRF protection.
        
            Args:
                request: FastAPI request with webhook payload
                stripe_signature: Stripe signature header for verification
        
            Returns:
                Webhook processing result
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/billing/webhooks/stripe/checkout:
    post:
      summary: Handle Stripe checkout.session.completed webhook
      operationId: stripe_checkout_webhook
      tags:
        - billing
      description: |
        Handle Stripe checkout.session.completed webhook
        
            This is called by Stripe when a payment is successful.
            We need to:
            1. Verify webhook signature
            2. Extract checkout session data
            3. Create Lago customer (if doesn't exist)
            4. Create Lago subscription
            5. Update Keycloak user tier
        
            This endpoint is exempt from authentication - Stripe calls it directly.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/byok/keys:
    get:
      summary: List user's configured API keys (masked)
      operationId: list_keys
      tags:
        - byok
      description: |
        List user's configured API keys (masked)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/byok/keys/test/{provider}:
    post:
      summary: Test if an API key is valid
      operationId: test_key
      tags:
        - byok
      description: |
        Test if an API key is valid
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
          description: Provider
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/byok/keys/{provider}:
    delete:
      summary: Remove an API key
      operationId: delete_key
      tags:
        - byok
      description: |
        Remove an API key
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
          description: Provider
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/byok/providers:
    get:
      summary: Get list of supported providers
      operationId: list_providers
      tags:
        - byok
      description: |
        Get list of supported providers
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/byok/stats:
    get:
      summary: Get statistics about user's BYOK configuration
      operationId: get_byok_stats
      tags:
        - byok
      description: |
        Get statistics about user's BYOK configuration
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/check-tier:
    get:
      summary: Check if user has access to a service based on their subscription tier.
      operationId: check_tier_access
      tags:
        - tier-check
      description: |
        Check if user has access to a service based on their subscription tier.
        
            Used by Traefik ForwardAuth middleware.
        
            Returns:
                200: Access granted
                401: Authentication required
                403: Upgrade required (tier too low)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/health:
    get:
      summary: Health check endpoint for Cloudflare API
      operationId: cloudflare_health_check
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Health check endpoint for Cloudflare API
        
            No authentication required for monitoring systems
        
            **Returns**: Health status and API connectivity
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/propagation/{zone_id}:
    get:
      summary: Check DNS propagation status for a zone
      operationId: check_propagation
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Check DNS propagation status for a zone
        
            **Rate Limit**: 10 requests per minute
        
            **Checks**:
            - Google DNS (8.8.8.8)
            - Cloudflare DNS (1.1.1.1)
            - Quad9 DNS (9.9.9.9)
            - OpenDNS (208.67.222.222)
        
            **Returns**: Propagation status across multiple DNS resolvers
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/zones:
    get:
      summary: Get all Cloudflare zones with optional filtering
      operationId: list_zones
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Get all Cloudflare zones with optional filtering
        
            **Rate Limit**: 30 requests per minute
        
            **Filters**:
            - status: Filter by zone status (pending, active, deactivated)
            - search: Search by domain name
            - limit: Maximum results per page (1-100)
            - offset: Pagination offset
        
            **Returns**: List of zones with metadata
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Create a new Cloudflare zone
      operationId: create_zone
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Create a new Cloudflare zone
        
            **Rate Limit**: 5 requests per minute (write operation)
        
            **Cloudflare Free Plan Limit**: Maximum 3 pending zones at once
        
            **Behavior**:
            - If under 3 pending zones: Zone created immediately
            - If at 3 pending zones: Zone added to queue
        
            **Returns**: Zone details or queue status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/zones/{zone_id}:
    get:
      summary: Get detailed information about a specific zone
      operationId: get_zone
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Get detailed information about a specific zone
        
            **Rate Limit**: 30 requests per minute
        
            **Returns**: Zone details including DNS record count and status
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a Cloudflare zone
      operationId: delete_zone
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Delete a Cloudflare zone
        
            **Rate Limit**: 5 requests per minute (write operation)
        
            **Warning**: This permanently deletes the zone and all DNS records!
        
            **Returns**: Success message
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/zones/{zone_id}/activate:
    post:
      summary: Check and activate a pending zone
      operationId: activate_zone
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Check and activate a pending zone
        
            **Rate Limit**: 10 requests per minute
        
            **Purpose**: Manually trigger activation check after nameservers are updated
        
            **Returns**: Updated zone status
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/zones/{zone_id}/analytics:
    get:
      summary: Get analytics data for a zone
      operationId: get_zone_analytics
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Get analytics data for a zone
        
            **Rate Limit**: 20 requests per minute
        
            **Metrics**:
            - Total requests
            - Bandwidth usage
            - Threat mitigation
            - Cache hit rate
        
            **Returns**: Analytics data for specified time period
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/zones/{zone_id}/dns:
    get:
      summary: List DNS records for a zone
      operationId: list_dns_records
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        List DNS records for a zone
        
            **Rate Limit**: 30 requests per minute
        
            **Filters**:
            - type: Filter by record type (A, AAAA, CNAME, MX, TXT, SRV, CAA)
            - search: Search by name or content
        
            **Returns**: List of DNS records
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Create a new DNS record
      operationId: create_dns_record
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Create a new DNS record
        
            **Rate Limit**: 10 requests per minute (write operation)
        
            **Record Types Supported**:
            - A: IPv4 address
            - AAAA: IPv6 address
            - CNAME: Canonical name (alias)
            - MX: Mail server (requires priority)
            - TXT: Text record (SPF, DKIM, DMARC, verification)
            - SRV: Service record (requires priority)
            - CAA: Certificate authority authorization
        
            **Returns**: Created DNS record details
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/zones/{zone_id}/dns/{record_id}:
    put:
      summary: Update an existing DNS record
      operationId: update_dns_record
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Update an existing DNS record
        
            **Rate Limit**: 10 requests per minute (write operation)
        
            **Updatable Fields**:
            - content: Record content (IP, hostname, text)
            - ttl: Time to live
            - proxied: Proxy through Cloudflare
            - priority: Priority (for MX and SRV records)
        
            **Returns**: Updated DNS record details
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
        - name: record_id
          in: path
          required: true
          schema:
            type: string
          description: Record Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a DNS record
      operationId: delete_dns_record
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Delete a DNS record
        
            **Rate Limit**: 10 requests per minute (write operation)
        
            **Warning**: Email-related records (MX, SPF, DKIM, DMARC) will show a warning
        
            **Returns**: Success message
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
        - name: record_id
          in: path
          required: true
          schema:
            type: string
          description: Record Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/zones/{zone_id}/nameservers:
    get:
      summary: Get assigned Cloudflare nameservers for a zone
      operationId: get_nameservers
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Get assigned Cloudflare nameservers for a zone
        
            **Rate Limit**: 30 requests per minute
        
            **Returns**: Nameserver list with copy-to-clipboard support
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update nameservers for a zone (advanced operation)
      operationId: update_nameservers
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Update nameservers for a zone (advanced operation)
        
            **Rate Limit**: 5 requests per minute (write operation)
        
            **Warning**: This is rarely needed. Usually nameservers are assigned by Cloudflare.
        
            **Returns**: Updated nameserver list
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/zones/{zone_id}/ssl:
    get:
      summary: Get SSL/TLS status for a zone
      operationId: get_ssl_status
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Get SSL/TLS status for a zone
        
            **Rate Limit**: 20 requests per minute
        
            **Returns**: SSL certificate status and configuration
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/cloudflare/zones/{zone_id}/status:
    get:
      summary: Get current status of a zone (pending, active, deactivated)
      operationId: get_zone_status
      tags:
        - cloudflare
        - dns
        - infrastructure
      description: |
        Get current status of a zone (pending, active, deactivated)
        
            **Rate Limit**: 30 requests per minute
        
            **Returns**: Zone status with activation details
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
          description: Zone Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credentials/health:
    get:
      summary: Health check endpoint for credential management API
      operationId: health_check
      tags:
        - credentials
        - security
      description: |
        Health check endpoint for credential management API
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credentials/services:
    get:
      summary: List all supported services and their credential types
      operationId: list_supported_services
      tags:
        - credentials
        - security
      description: |
        List all supported services and their credential types
        
            **Authentication**: Requires admin role
        
            **Returns**:
            - List of supported services with:
              - Service name and display name
              - Supported credential types
              - Whether test endpoint is available
              - Whether user has configured credentials
        
            **Example Response**:
            ```json
            [
              {
                "service": "cloudflare",
                "name": "Cloudflare",
                "credential_types": ["api_token"],
                "has_test": true,
                "configured": false
              },
              ...
            ]
            ```
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credentials/{service}/test:
    post:
      summary: Test credential by calling service API
      operationId: test_credential
      tags:
        - credentials
        - security
      description: |
        Test credential by calling service API
        
            **Authentication**: Requires admin role
        
            **Path Parameters**:
            - `service`: Service name
        
            **Request Body**:
            - `value`: Optional credential value to test (if not stored in DB)
        
            **Returns**:
            - Test result with success/failure status and message
        
            **Supported Services**:
            - **Cloudflare**: Calls `/user/tokens/verify` endpoint
            - **GitHub**: Calls `/user` endpoint
            - **Stripe**: Calls `/v1/balance` endpoint
            - **NameCheap**: Format validation only (API requires IP whitelist)
        
            **Security**:
            - Rate limited to prevent abuse
            - Test result stored in database
            - Audit log created for test
      parameters:
        - name: service
          in: path
          required: true
          schema:
            type: string
          description: Service
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credentials/{service}/{credential_type}:
    get:
      summary: Get single credential info (MASKED value only)
      operationId: get_credential
      tags:
        - credentials
        - security
      description: |
        Get single credential info (MASKED value only)
        
            **Authentication**: Requires admin role
        
            **Path Parameters**:
            - `service`: Service name
            - `credential_type`: Credential type
        
            **Returns**:
            - Credential info with MASKED value
        
            **Security**:
            - NEVER returns plaintext credential
            - Use `get_credential_for_api()` internally for API calls
      parameters:
        - name: service
          in: path
          required: true
          schema:
            type: string
          description: Service
        - name: credential_type
          in: path
          required: true
          schema:
            type: string
          description: Credential Type
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update existing credential
      operationId: update_credential
      tags:
        - credentials
        - security
      description: |
        Update existing credential
        
            **Authentication**: Requires admin role
        
            **Path Parameters**:
            - `service`: Service name
            - `credential_type`: Credential type
        
            **Request Body**:
            - `value`: New plaintext credential value
            - `metadata`: Optional updated metadata
        
            **Returns**:
            - Updated credential info with MASKED value
        
            **Security**:
            - Credential re-encrypted with new value
            - Audit log created for update
            - Test status reset (requires re-test)
      parameters:
        - name: service
          in: path
          required: true
          schema:
            type: string
          description: Service
        - name: credential_type
          in: path
          required: true
          schema:
            type: string
          description: Credential Type
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete credential (soft delete)
      operationId: delete_credential
      tags:
        - credentials
        - security
      description: |
        Delete credential (soft delete)
        
            **Authentication**: Requires admin role
        
            **Path Parameters**:
            - `service`: Service name
            - `credential_type`: Credential type
        
            **Returns**:
            - 204 No Content on success
            - 404 Not Found if credential doesn't exist
        
            **Security**:
            - Soft delete (sets is_active = false)
            - Credential remains in database for audit trail
            - Audit log created for deletion
      parameters:
        - name: service
          in: path
          required: true
          schema:
            type: string
          description: Service
        - name: credential_type
          in: path
          required: true
          schema:
            type: string
          description: Credential Type
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/allocate:
    post:
      summary: Allocate credits to a user (admin only).
      operationId: allocate_credits
      tags:
        - credits
      description: |
        Allocate credits to a user (admin only).
        
            Args:
                request: Credit allocation details
        
            Returns:
                CreditBalance: Updated balance information
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/balance:
    get:
      summary: Get user's current credit balance.
      operationId: get_credit_balance
      tags:
        - credits
      description: |
        Get user's current credit balance.
        
            Returns:
                CreditBalance: Current balance and allocation details
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/coupons:
    get:
      summary: List all coupons (admin only).
      operationId: list_coupons
      tags:
        - credits
      description: |
        List all coupons (admin only).
        
            Args:
                active_only: Only return active coupons
                limit: Maximum number of coupons
                offset: Pagination offset
        
            Returns:
                List[CouponCode]: List of coupons
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/coupons/create:
    post:
      summary: Create coupon code (admin only).
      operationId: create_coupon
      tags:
        - credits
      description: |
        Create coupon code (admin only).
        
            Args:
                request: Coupon details
        
            Returns:
                CouponCode: Created coupon information
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/coupons/redeem:
    post:
      summary: Redeem coupon code.
      operationId: redeem_coupon
      tags:
        - credits
      description: |
        Redeem coupon code.
        
            Args:
                request: Coupon code to redeem
        
            Returns:
                CouponRedemption: Redemption details with credits awarded
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/coupons/validate/{code}:
    get:
      summary: Validate coupon code.
      operationId: validate_coupon
      tags:
        - credits
      description: |
        Validate coupon code.
        
            Args:
                code: Coupon code to validate
        
            Returns:
                CouponValidation: Validation result
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
          description: Code
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/coupons/{code}:
    delete:
      summary: Deactivate coupon (admin only).
      operationId: delete_coupon
      tags:
        - credits
      description: |
        Deactivate coupon (admin only).
        
            Args:
                code: Coupon code to deactivate
        
            Returns:
                Dict: Success message
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
          description: Code
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/deduct:
    post:
      summary: Deduct credits from user (internal/admin only).
      operationId: deduct_credits
      tags:
        - credits
      description: |
        Deduct credits from user (internal/admin only).
        
            Args:
                request: Credit deduction details
        
            Returns:
                CreditBalance: Updated balance information
        
            Raises:
                HTTPException 400: Insufficient credits
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/openrouter/account:
    get:
      summary: Get OpenRouter account details.
      operationId: get_openrouter_account
      tags:
        - credits
      description: |
        Get OpenRouter account details.
        
            Returns:
                OpenRouterAccount | None: Account information or None if not configured
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete OpenRouter BYOK account.
      operationId: delete_openrouter_account
      tags:
        - credits
      description: |
        Delete OpenRouter BYOK account.
        
            Returns:
                Dict: Success message
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/openrouter/create-account:
    post:
      summary: Create OpenRouter BYOK account for user.
      operationId: create_openrouter_account
      tags:
        - credits
      description: |
        Create OpenRouter BYOK account for user.
        
            Args:
                request: OpenRouter API key and email
        
            Returns:
                OpenRouterAccount: Account information
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/openrouter/sync-balance:
    post:
      summary: Sync free credits from OpenRouter API.
      operationId: sync_openrouter_balance
      tags:
        - credits
      description: |
        Sync free credits from OpenRouter API.
        
            Returns:
                Dict: {"free_credits": Decimal}
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/refund:
    post:
      summary: Refund credits to user (admin only).
      operationId: refund_credits
      tags:
        - credits
      description: |
        Refund credits to user (admin only).
        
            Args:
                request: Refund details
        
            Returns:
                CreditBalance: Updated balance information
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/tiers/compare:
    get:
      summary: Compare subscription tiers.
      operationId: compare_tiers
      tags:
        - credits
      description: |
        Compare subscription tiers.
        
            Returns:
                List[TierInfo]: Available subscription tiers
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/tiers/switch:
    post:
      summary: Switch subscription tier (triggers monthly credit reset).
      operationId: switch_tier
      tags:
        - credits
      description: |
        Switch subscription tier (triggers monthly credit reset).
        
            Args:
                request: New tier selection
        
            Returns:
                CreditBalance: Updated balance with new allocation
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/transactions:
    get:
      summary: Get credit transaction history.
      operationId: get_transactions
      tags:
        - credits
      description: |
        Get credit transaction history.
        
            Args:
                limit: Maximum number of transactions (1-500)
                offset: Pagination offset
                transaction_type: Filter by type (optional)
        
            Returns:
                List[CreditTransaction]: Transaction history
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/usage/by-model:
    get:
      summary: Get usage breakdown by model.
      operationId: get_usage_by_model
      tags:
        - credits
      description: |
        Get usage breakdown by model.
        
            Returns:
                List[UsageByModel]: Per-model usage statistics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/usage/by-service:
    get:
      summary: Get usage breakdown by service.
      operationId: get_usage_by_service
      tags:
        - credits
      description: |
        Get usage breakdown by service.
        
            Returns:
                List[UsageByService]: Per-service usage statistics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/usage/free-tier:
    get:
      summary: Get free tier usage statistics.
      operationId: get_free_tier_usage
      tags:
        - credits
      description: |
        Get free tier usage statistics.
        
            Returns:
                Dict: Free tier usage summary
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/usage/summary:
    get:
      summary: Get usage summary for user.
      operationId: get_usage_summary
      tags:
        - credits
      description: |
        Get usage summary for user.
        
            Args:
                start_date: Start date (optional, defaults to 30 days ago)
                end_date: End date (optional, defaults to now)
        
            Returns:
                UsageSummary: Aggregated usage statistics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/credits/usage/track:
    post:
      summary: Track API usage event.
      operationId: track_usage
      tags:
        - credits
      description: |
        Track API usage event.
        
            Args:
                request: Usage event details
        
            Returns:
                UsageEvent: Created usage event
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/execution-servers/default:
    get:
      summary: Get user's default execution server
      operationId: get_default_server
      tags:
        - execution-servers
      description: |
        Get user's default execution server
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/execution-servers/{server_id}:
    put:
      summary: Update execution server
      operationId: update_server
      tags:
        - execution-servers
      description: |
        Update execution server
      parameters:
        - name: server_id
          in: path
          required: true
          schema:
            type: string
          description: Server Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete execution server
      operationId: delete_server
      tags:
        - execution-servers
      description: |
        Delete execution server
      parameters:
        - name: server_id
          in: path
          required: true
          schema:
            type: string
          description: Server Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/execution-servers/{server_id}/test:
    post:
      summary: Test execution server connection
      operationId: test_server
      tags:
        - execution-servers
      description: |
        Test execution server connection
      parameters:
        - name: server_id
          in: path
          required: true
          schema:
            type: string
          description: Server Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/active:
    get:
      summary: Get all active providers for all purposes
      operationId: get_all_active_providers
      tags:
        - LLM Configuration
      description: |
        Get all active providers for all purposes
        
            Returns a dictionary:
            {
                "chat": {...},
                "embeddings": {...},
                "reranking": {...}
            }
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Set active provider for a purpose
      operationId: set_active_provider
      tags:
        - LLM Configuration
      description: |
        Set active provider for a purpose
        
            Request Body:
            - purpose: chat, embeddings, or reranking
            - provider_type: ai_server or api_key
            - provider_id: ID of the provider
            - fallback_provider_type: Optional fallback type
            - fallback_provider_id: Optional fallback ID
        
            Example:
            {
                "purpose": "chat",
                "provider_type": "ai_server",
                "provider_id": 1,
                "fallback_provider_type": "api_key",
                "fallback_provider_id": 2
            }
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/active/{purpose}:
    get:
      summary: Get active provider for specific purpose
      operationId: get_active_provider
      tags:
        - LLM Configuration
      description: |
        Get active provider for specific purpose
        
            Path Parameters:
            - purpose: chat, embeddings, or reranking
      parameters:
        - name: purpose
          in: path
          required: true
          schema:
            type: string
          description: Purpose
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/api-keys:
    get:
      summary: List all API keys (MASKED - never returns plaintext keys)
      operationId: list_api_keys
      tags:
        - LLM Configuration
      description: |
        List all API keys (MASKED - never returns plaintext keys)
        
            Query Parameters:
            - enabled_only: Only return enabled keys
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Create new API key (encrypted storage)
      operationId: create_api_key
      tags:
        - LLM Configuration
      description: |
        Create new API key (encrypted storage)
        
            Request Body:
            - provider: openrouter, openai, anthropic, google, cohere, together, fireworks
            - key_name: Friendly name for UI
            - api_key: Plaintext API key (will be encrypted)
            - use_for_ops_center: Use for ops-center services
            - metadata: Optional metadata (rate limits, etc.)
        
            Security: API key is encrypted with Fernet before storage
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/api-keys/{key_id}:
    get:
      summary: Get specific API key by ID (MASKED)
      operationId: get_api_key
      tags:
        - LLM Configuration
      description: |
        Get specific API key by ID (MASKED)
      parameters:
        - name: key_id
          in: path
          required: true
          schema:
            type: string
          description: Key Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update API key
      operationId: update_api_key
      tags:
        - LLM Configuration
      description: |
        Update API key
        
            Path Parameters:
            - key_id: Key ID to update
        
            Request Body: (all fields optional)
            - key_name: Update friendly name
            - api_key: New API key to re-encrypt
            - enabled: Enable/disable key
            - use_for_ops_center: Toggle ops-center usage
            - metadata: Update metadata
      parameters:
        - name: key_id
          in: path
          required: true
          schema:
            type: string
          description: Key Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete API key
      operationId: delete_api_key
      tags:
        - LLM Configuration
      description: |
        Delete API key
        
            Returns 400 if key is currently in use as active provider
      parameters:
        - name: key_id
          in: path
          required: true
          schema:
            type: string
          description: Key Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/api-keys/{key_id}/test:
    post:
      summary: Test API key validity
      operationId: test_api_key
      tags:
        - LLM Configuration
      description: |
        Test API key validity
        
            Makes a minimal request to the provider's API to verify the key works.
            Does NOT update usage statistics (tokens_used, requests_count, etc.)
        
            Returns:
            - success: True if key is valid
            - message: Details about the test result
      parameters:
        - name: key_id
          in: path
          required: true
          schema:
            type: string
          description: Key Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/health:
    get:
      summary: Health check endpoint
      operationId: health_check
      tags:
        - LLM Configuration
      description: |
        Health check endpoint
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/servers:
    get:
      summary: List all AI servers
      operationId: list_ai_servers
      tags:
        - LLM Configuration
      description: |
        List all AI servers
        
            Query Parameters:
            - enabled_only: Only return enabled servers
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Create new AI server configuration
      operationId: create_ai_server
      tags:
        - LLM Configuration
      description: |
        Create new AI server configuration
        
            Request Body:
            - name: Friendly name
            - server_type: vllm, ollama, llamacpp, openai-compatible
            - base_url: Server URL (e.g., http://localhost:8000)
            - api_key: Optional API key for protected endpoints
            - model_path: Optional model path (for vLLM/llama.cpp)
            - enabled: Enable immediately (default: true)
            - use_for_chat/embeddings/reranking: Purpose flags
            - metadata: Additional config (JSON)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/servers/{server_id}:
    get:
      summary: Get specific AI server by ID
      operationId: get_ai_server
      tags:
        - LLM Configuration
      description: |
        Get specific AI server by ID
      parameters:
        - name: server_id
          in: path
          required: true
          schema:
            type: string
          description: Server Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update AI server configuration
      operationId: update_ai_server
      tags:
        - LLM Configuration
      description: |
        Update AI server configuration
        
            Path Parameters:
            - server_id: Server ID to update
        
            Request Body: (all fields optional)
            - name, server_type, base_url, api_key, model_path
            - enabled, use_for_chat, use_for_embeddings, use_for_reranking
            - metadata
      parameters:
        - name: server_id
          in: path
          required: true
          schema:
            type: string
          description: Server Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete AI server configuration
      operationId: delete_ai_server
      tags:
        - LLM Configuration
      description: |
        Delete AI server configuration
        
            Returns 400 if server is currently in use as active provider
      parameters:
        - name: server_id
          in: path
          required: true
          schema:
            type: string
          description: Server Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/servers/{server_id}/models:
    get:
      summary: Get list of available models from AI server
      operationId: get_ai_server_models
      tags:
        - LLM Configuration
      description: |
        Get list of available models from AI server
        
            Queries the server's /v1/models endpoint (or /api/tags for Ollama)
            and returns available model names.
      parameters:
        - name: server_id
          in: path
          required: true
          schema:
            type: string
          description: Server Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm-config/servers/{server_id}/test:
    post:
      summary: Test connection to AI server
      operationId: test_ai_server
      tags:
        - LLM Configuration
      description: |
        Test connection to AI server
        
            Attempts to connect to the server and verify it's working.
            Updates health_status and last_health_check in database.
        
            Returns:
            - status: healthy, degraded, down, unknown
            - message: Details about the health check
      parameters:
        - name: server_id
          in: path
          required: true
          schema:
            type: string
          description: Server Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/byok/keys:
    post:
      summary: Add/update user's own API key for a provider
      operationId: add_byok_key
      tags:
        - LLM
      description: |
        Add/update user's own API key for a provider
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    get:
      summary: List user's stored provider keys (masked)
      operationId: list_byok_keys
      tags:
        - LLM
      description: |
        List user's stored provider keys (masked)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/byok/keys/{provider}:
    delete:
      summary: Delete user's API key for a provider
      operationId: delete_byok_key
      tags:
        - LLM
      description: |
        Delete user's API key for a provider
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
          description: Provider
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/chat/completions:
    post:
      summary: OpenAI-compatible chat completions endpoint with credit system
      operationId: chat_completions
      tags:
        - LLM
      description: |
        OpenAI-compatible chat completions endpoint with credit system
        
            Request Headers:
                Authorization: Bearer <user-api-key>
                X-Power-Level: eco | balanced | precision (optional)
        
            Returns:
                OpenAI-compatible chat completion response
                + X-Provider-Used: Provider that handled request
                + X-Cost-Incurred: Credits deducted
                + X-Credits-Remaining: Updated balance
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/credits:
    get:
      summary: Get current credit balance
      operationId: get_credits
      tags:
        - LLM
      description: |
        Get current credit balance
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    get:
      summary: Get user's credit balance and usage
      operationId: get_credit_status
      tags:
        - LLM Management
      description: |
        Get user's credit balance and usage
        
            Query Parameters:
                user_id: User identifier
        
            Returns:
                Credit balance, tier, usage limits
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/credits/history:
    get:
      summary: Get credit transaction history
      operationId: get_credit_history
      tags:
        - LLM
      description: |
        Get credit transaction history
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/credits/purchase:
    post:
      summary: Purchase credits via Stripe
      operationId: purchase_credits
      tags:
        - LLM
      description: |
        Purchase credits via Stripe
        
            Credit packages:
            - $10 = 10,000 credits
            - $50 = 55,000 credits (10% bonus)
            - $100 = 120,000 credits (20% bonus)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/health:
    get:
      summary: Health check endpoint
      operationId: health_check
      tags:
        - LLM
      description: |
        Health check endpoint
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/models:
    get:
      summary: List available models based on user tier
      operationId: list_models
      tags:
        - LLM
      description: |
        List available models based on user tier
        
            Returns OpenAI-compatible model list
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    get:
      summary: List all available LLM models across providers
      operationId: list_models
      tags:
        - LLM Management
      description: |
        List all available LLM models across providers
        
            Query Parameters:
                provider_id: Filter by provider UUID
                enabled_only: Only return enabled models
                sort_by: Sort by cost, latency, or name
        
            Returns:
                List of models with pricing and performance data
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Add new model to provider
      operationId: create_model
      tags:
        - LLM Management
      description: |
        Add new model to provider
        
            Body:
                ModelCreate schema
        
            Returns:
                Created model with ID
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/providers:
    get:
      summary: List all configured LLM providers
      operationId: list_providers
      tags:
        - LLM Management
      description: |
        List all configured LLM providers
        
            Query Parameters:
                enabled_only: Only return enabled providers
        
            Returns:
                List of providers with statistics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Add new LLM provider with encrypted API key
      operationId: create_provider
      tags:
        - LLM Management
      description: |
        Add new LLM provider with encrypted API key
        
            Body:
                ProviderCreate schema
        
            Returns:
                Created provider with ID
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/providers/{provider_id}:
    put:
      summary: Update provider configuration
      operationId: update_provider
      tags:
        - LLM Management
      description: |
        Update provider configuration
        
            Path Parameters:
                provider_id: Provider UUID
        
            Body:
                ProviderUpdate schema
        
            Returns:
                Updated provider info
      parameters:
        - name: provider_id
          in: path
          required: true
          schema:
            type: string
          description: Provider Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Remove provider (will cascade delete associated models)
      operationId: delete_provider
      tags:
        - LLM Management
      description: |
        Remove provider (will cascade delete associated models)
        
            Path Parameters:
                provider_id: Provider UUID
        
            Returns:
                Deletion confirmation
      parameters:
        - name: provider_id
          in: path
          required: true
          schema:
            type: string
          description: Provider Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/routing/rules:
    get:
      summary: Get current routing configuration
      operationId: get_routing_rules
      tags:
        - LLM Management
      description: |
        Get current routing configuration
        
            Returns:
                Routing strategy, fallback rules, model aliases
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update routing configuration
      operationId: update_routing_rules
      tags:
        - LLM Management
      description: |
        Update routing configuration
        
            Body:
                RoutingRulesUpdate schema
        
            Returns:
                Updated routing rules
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/test:
    post:
      summary: Test provider connection with sample request
      operationId: test_provider_connection
      tags:
        - LLM Management
      description: |
        Test provider connection with sample request
        
            Body:
                ProviderTestRequest schema
        
            Returns:
                Test results with latency and status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/usage:
    get:
      summary: Get usage statistics
      operationId: get_usage_stats
      tags:
        - LLM
      description: |
        Get usage statistics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    get:
      summary: Get LLM usage analytics
      operationId: get_usage_analytics
      tags:
        - LLM Management
      description: |
        Get LLM usage analytics
        
            Query Parameters:
                user_id: Filter by user (admin only without user_id)
                days: Number of days to analyze (default 7)
                provider_id: Filter by provider
        
            Returns:
                Usage statistics with cost breakdown
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/llm/users/{user_id}/byok:
    post:
      summary: Set user's Bring Your Own Key configuration
      operationId: set_user_byok
      tags:
        - LLM Management
      description: |
        Set user's Bring Your Own Key configuration
        
            Path Parameters:
                user_id: User identifier
        
            Body:
                UserBYOKUpdate schema
        
            Returns:
                Updated BYOK configuration
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
          description: User Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    get:
      summary: Get user's BYOK configuration (API keys masked)
      operationId: get_user_byok
      tags:
        - LLM Management
      description: |
        Get user's BYOK configuration (API keys masked)
        
            Path Parameters:
                user_id: User identifier
        
            Returns:
                BYOK configuration with masked keys
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
          description: User Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/local-users/:
    get:
      summary: List local Linux users with pagination and filtering.
      operationId: list_local_users
      tags:
        - Local Users
      description: |
        List local Linux users with pagination and filtering.
        
            **Requires**: Admin role
        
            **NEW FEATURES**:
            - Pagination support (skip/limit)
            - Search by username
            - Filter by sudo status
            - Filter by UID range
        
            **Parameters**:
            - `include_system`: Include system users (UID < 1000)
            - `skip`: Number of users to skip (pagination offset) [default: 0]
            - `limit`: Maximum number of users to return [default: 50, max: 100]
            - `search`: Search username pattern (partial match)
            - `has_sudo`: Filter by sudo status (true/false)
            - `uid_min`: Minimum UID to include
            - `uid_max`: Maximum UID to include
        
            **Returns**: List of user information objects (paginated)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Create a new local Linux user.
      operationId: create_local_user
      tags:
        - Local Users
      description: |
        Create a new local Linux user.
        
            **Requires**: Admin role
        
            **Parameters**:
            - `username`: Username for new user (lowercase, alphanumeric + underscore/hyphen)
            - `full_name`: Full name (GECOS field)
            - `shell`: Login shell (default: /bin/bash)
            - `create_home`: Create home directory (default: true)
            - `groups`: Additional groups to add user to
            - `password`: Initial password (optional, min 12 characters with complexity)
        
            **Returns**: Created user information
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/local-users/statistics:
    get:
      summary: Get statistics about local users.
      operationId: get_user_statistics
      tags:
        - Local Users
      description: |
        Get statistics about local users.
        
            **NEW FEATURE**: System-wide user statistics endpoint.
        
            **Requires**: Admin role
        
            **Returns**: Statistics object with:
            - `total_users`: Total number of non-system users
            - `sudo_users`: Number of users with sudo privileges
            - `system_users`: Number of system users (UID < 1000)
            - `users_by_shell`: Count by shell type
            - `total_home_size_bytes`: Total size of all home directories
            - `total_home_size_gb`: Total size in GB
            - `uid_range`: Min and max UID values
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/local-users/{username}:
    get:
      summary: Get detailed information about a local user.
      operationId: get_local_user
      tags:
        - Local Users
      description: |
        Get detailed information about a local user.
        
            **Requires**: Admin role
        
            **Parameters**:
            - `username`: Username to query
        
            **Returns**: User information object
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a local Linux user.
      operationId: delete_local_user
      tags:
        - Local Users
      description: |
        Delete a local Linux user.
        
            **Requires**: Admin role
        
            **WARNING**: This operation cannot be undone!
        
            **SECURITY**: Prevents admins from deleting their own account.
        
            **Parameters**:
            - `username`: Username to delete
            - `remove_home`: Also remove home directory (default: false)
        
            **Returns**: Success message
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/local-users/{username}/password:
    post:
      summary: Set password for a local user.
      operationId: set_user_password
      tags:
        - Local Users
      description: |
        Set password for a local user.
        
            **Requires**: Admin role
        
            **Parameters**:
            - `username`: Username
            - `password`: New password (min 12 characters with uppercase, lowercase, digit, special character)
        
            **Returns**: Success message
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/local-users/{username}/ssh-keys:
    get:
      summary: List SSH public keys for a user.
      operationId: get_ssh_keys
      tags:
        - Local Users
      description: |
        List SSH public keys for a user.
        
            **Requires**: Admin role
        
            **Parameters**:
            - `username`: Username
        
            **Returns**: List of SSH key objects
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Add SSH public key to user's authorized_keys.
      operationId: add_user_ssh_key
      tags:
        - Local Users
      description: |
        Add SSH public key to user's authorized_keys.
        
            **Requires**: Admin role
        
            **Parameters**:
            - `username`: Username
            - `ssh_key`: SSH public key (must be valid format)
            - `key_title`: Optional title/comment for the key
        
            **Returns**: Key information with fingerprint
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/local-users/{username}/ssh-keys/{key_fingerprint}:
    delete:
      summary: Remove SSH public key from user's authorized_keys.
      operationId: remove_user_ssh_key
      tags:
        - Local Users
      description: |
        Remove SSH public key from user's authorized_keys.
        
            **Requires**: Admin role
        
            **Parameters**:
            - `username`: Username
            - `key_fingerprint`: Fingerprint of key to remove
        
            **Returns**: Success message
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
        - name: key_fingerprint
          in: path
          required: true
          schema:
            type: string
          description: Key Fingerprint
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/local-users/{username}/sudo:
    post:
      summary: Grant sudo permissions to a user.
      operationId: grant_sudo
      tags:
        - Local Users
      description: |
        Grant sudo permissions to a user.
        
            **Requires**: Admin role
        
            **WARNING**: This gives the user full system access via sudo!
        
            **Parameters**:
            - `username`: Username
        
            **Returns**: Success message
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Revoke sudo permissions from a user.
      operationId: revoke_sudo
      tags:
        - Local Users
      description: |
        Revoke sudo permissions from a user.
        
            **Requires**: Admin role
        
            **Parameters**:
            - `username`: Username
        
            **Returns**: Success message
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/health:
    get:
      summary: Health check endpoint for migration API
      operationId: migration_health_check
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Health check endpoint for migration API
        
            No authentication required for monitoring systems
        
            **Returns**: Health status and service connectivity
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/execute:
    post:
      summary: Execute a migration job
      operationId: execute_migration
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Execute a migration job
        
            **Rate Limit**: 3 requests per minute (critical operation)
        
            **Process**:
            1. Add domains to Cloudflare (with queue handling)
            2. Import DNS records
            3. Update nameservers at NameCheap
            4. Monitor propagation
        
            **Returns**: Migration job ID and initial status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/preview:
    post:
      summary: Preview migration plan before execution
      operationId: preview_migration
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Preview migration plan before execution
        
            **Rate Limit**: 5 requests per minute (write operation)
        
            **Creates**:
            - Migration job record
            - DNS record preview
            - Email service validation
            - Nameserver update plan
        
            **Returns**: Migration preview ID and detailed plan
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/preview/{migration_id}:
    get:
      summary: Get details of a migration preview
      operationId: get_migration_preview
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Get details of a migration preview
        
            **Rate Limit**: 20 requests per minute
        
            **Returns**: Full migration plan with DNS records and warnings
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/validate:
    post:
      summary: Validate DNS records before migration
      operationId: validate_migration
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Validate DNS records before migration
        
            **Rate Limit**: 10 requests per minute
        
            **Checks**:
            - Valid IP addresses
            - Valid hostnames
            - MX record priorities
            - Email service records
        
            **Returns**: Validation results with warnings and errors
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/{migration_id}/health:
    get:
      summary: Get overall health check for a migration
      operationId: get_migration_health
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Get overall health check for a migration
        
            **Rate Limit**: 20 requests per minute
        
            **Combines**:
            - DNS propagation status
            - SSL certificate status
            - Email functionality
            - Website accessibility
        
            **Returns**: Comprehensive health check results
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/{migration_id}/pause:
    post:
      summary: Pause a running migration job
      operationId: pause_migration
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Pause a running migration job
        
            **Rate Limit**: 5 requests per minute
        
            **Returns**: Updated migration status
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/{migration_id}/resume:
    post:
      summary: Resume a paused migration job
      operationId: resume_migration
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Resume a paused migration job
        
            **Rate Limit**: 5 requests per minute
        
            **Returns**: Updated migration status
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/{migration_id}/rollback:
    post:
      summary: Rollback a migration (revert nameservers to original values)
      operationId: rollback_migration
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Rollback a migration (revert nameservers to original values)
        
            **Rate Limit**: 3 requests per minute (critical operation)
        
            **Warning**: This reverts nameservers at NameCheap but keeps Cloudflare zone
        
            **Returns**: Rollback status
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/{migration_id}/status:
    get:
      summary: Get current status of a migration job
      operationId: get_migration_status
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Get current status of a migration job
        
            **Rate Limit**: 30 requests per minute
        
            **Returns**: Real-time migration progress and status
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/{migration_id}/verify/dns:
    post:
      summary: Check DNS propagation status across multiple resolvers
      operationId: verify_dns_propagation
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Check DNS propagation status across multiple resolvers
        
            **Rate Limit**: 10 requests per minute
        
            **Checks**:
            - Google DNS (8.8.8.8)
            - Cloudflare DNS (1.1.1.1)
            - Quad9 DNS (9.9.9.9)
            - OpenDNS (208.67.222.222)
        
            **Returns**: Propagation status per resolver and overall percentage
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/{migration_id}/verify/email:
    post:
      summary: Test email delivery for migrated domains
      operationId: verify_email_functionality
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Test email delivery for migrated domains
        
            **Rate Limit**: 10 requests per minute
        
            **Checks**:
            - MX records present
            - SPF record configured
            - DMARC record configured
            - DKIM records present
        
            **Returns**: Email service health status
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/{migration_id}/verify/ssl:
    post:
      summary: Verify SSL certificates for migrated domains
      operationId: verify_ssl_certificates
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Verify SSL certificates for migrated domains
        
            **Rate Limit**: 10 requests per minute
        
            **Checks**:
            - SSL certificate issued
            - Certificate valid
            - Certificate matches domain
            - Certificate issuer (Cloudflare)
        
            **Returns**: SSL status per domain
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/migration/{migration_id}/verify/website:
    post:
      summary: Check website accessibility for migrated domains
      operationId: verify_website_accessibility
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Check website accessibility for migrated domains
        
            **Rate Limit**: 10 requests per minute
        
            **Checks**:
            - HTTP accessible (with redirect to HTTPS)
            - HTTPS accessible
            - Valid response codes
            - Cloudflare proxy active
        
            **Returns**: Website accessibility status
      parameters:
        - name: migration_id
          in: path
          required: true
          schema:
            type: string
          description: Migration Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/namecheap/domains:
    get:
      summary: Get all domains from NameCheap account
      operationId: list_namecheap_domains
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Get all domains from NameCheap account
        
            **Rate Limit**: 10 requests per minute
        
            **Filters**:
            - status: Filter by domain status (active, expired, locked)
            - search: Search by domain name
        
            **Returns**: List of NameCheap domains with migration status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/namecheap/domains/bulk-check:
    post:
      summary: Check availability and status of multiple domains
      operationId: bulk_check_domains
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Check availability and status of multiple domains
        
            **Rate Limit**: 5 requests per minute (write operation)
        
            **Returns**: Status and migration readiness for each domain
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/namecheap/domains/bulk-export:
    post:
      summary: Export DNS records for multiple domains
      operationId: bulk_export_dns
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Export DNS records for multiple domains
        
            **Rate Limit**: 5 requests per minute (write operation)
        
            **Returns**: DNS records for all requested domains
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/namecheap/domains/{domain}:
    get:
      summary: Get detailed information about a specific domain from NameCheap
      operationId: get_namecheap_domain
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Get detailed information about a specific domain from NameCheap
        
            **Rate Limit**: 10 requests per minute
        
            **Returns**: Domain details including DNS, nameservers, and status
      parameters:
        - name: domain
          in: path
          required: true
          schema:
            type: string
          description: Domain
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/namecheap/domains/{domain}/dns:
    get:
      summary: Export DNS records from NameCheap for a domain
      operationId: export_dns_records
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Export DNS records from NameCheap for a domain
        
            **Rate Limit**: 10 requests per minute
        
            **Formats**:
            - json: JSON format (default)
            - csv: CSV format
            - bind: BIND zone file format
        
            **Returns**: DNS records in requested format
      parameters:
        - name: domain
          in: path
          required: true
          schema:
            type: string
          description: Domain
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/migration/namecheap/domains/{domain}/email:
    get:
      summary: Detect email service provider for a domain
      operationId: detect_email_service
      tags:
        - migration
        - namecheap
        - dns
      description: |
        Detect email service provider for a domain
        
            **Rate Limit**: 10 requests per minute
        
            **Detects**:
            - Microsoft 365
            - NameCheap Private Email
            - Google Workspace
            - Email forwarding
        
            **Returns**: Email service details and critical records to preserve
      parameters:
        - name: domain
          in: path
          required: true
          schema:
            type: string
          description: Domain
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/disable:
    post:
      summary: Disable UFW firewall
      operationId: disable_firewall
      tags:
        - network
        - firewall
      description: |
        Disable UFW firewall
        
            **Rate Limit**: 3 requests per 60 seconds
        
            **Warning**: This will disable all firewall protection!
            System will be exposed to network traffic.
        
            **Returns**: Success message
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/enable:
    post:
      summary: Enable UFW firewall
      operationId: enable_firewall
      tags:
        - network
        - firewall
      description: |
        Enable UFW firewall
        
            **Rate Limit**: 3 requests per 60 seconds
        
            **Warning**: This will activate all configured firewall rules immediately!
            Ensure SSH access is allowed before enabling on remote systems.
        
            **Returns**: Success message
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/health:
    get:
      summary: Health check endpoint for firewall API
      operationId: firewall_health_check
      tags:
        - network
        - firewall
      description: |
        Health check endpoint for firewall API
        
            No authentication required for monitoring systems
        
            **Returns**: Health status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/logs:
    get:
      summary: Get recent firewall logs (blocked/allowed traffic)
      operationId: get_firewall_logs
      tags:
        - network
        - firewall
      description: |
        Get recent firewall logs (blocked/allowed traffic)
        
            **Rate Limit**: 10 requests per 60 seconds
        
            **Parameters**:
            - limit: Maximum number of log entries (default: 100, max: 1000)
            - filter_action: Filter by action (BLOCK/ALLOW)
        
            **Returns**: List of recent firewall log entries
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/reset:
    post:
      summary: Reset firewall to default configuration
      operationId: reset_firewall
      tags:
        - network
        - firewall
      description: |
        Reset firewall to default configuration
        
            **Rate Limit**: 2 requests per 60 seconds
        
            **DANGER**: This will delete ALL firewall rules and reset to defaults!
            SSH access rule will be preserved for safety.
        
            **Parameters**:
            - confirm: Must be true to proceed (safety check)
        
            **Returns**: Success message
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/rules:
    get:
      summary: Get all firewall rules with optional filtering
      operationId: list_firewall_rules
      tags:
        - network
        - firewall
      description: |
        Get all firewall rules with optional filtering
        
            **Rate Limit**: 20 requests per 60 seconds
        
            **Filters**:
            - status: Filter by rule status (active/inactive)
            - protocol: Filter by protocol (tcp/udp/both)
            - action: Filter by action (allow/deny/reject)
        
            **Returns**: List of firewall rules with metadata
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Add new firewall rule
      operationId: add_firewall_rule
      tags:
        - network
        - firewall
      description: |
        Add new firewall rule
        
            **Rate Limit**: 5 requests per 60 seconds
        
            **Required Fields**:
            - port: Port number (1-65535) or None for all ports
            - protocol: tcp, udp, both, or any
            - action: allow, deny, reject, or limit
        
            **Optional Fields**:
            - description: Human-readable description
            - from_ip: Source IP or CIDR (e.g., 192.168.1.0/24)
            - to_ip: Destination IP
            - interface: Network interface name
        
            **Returns**: Success message with rule details
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/rules/bulk-delete:
    post:
      summary: Delete multiple firewall rules at once
      operationId: bulk_delete_firewall_rules
      tags:
        - network
        - firewall
      description: |
        Delete multiple firewall rules at once
        
            **Rate Limit**: 3 requests per 60 seconds
        
            **Request Body**:
            - rule_numbers: Array of rule numbers to delete
            - override_ssh: Override SSH protection for all rules
        
            **Returns**: Summary of deleted rules
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/rules/{rule_num}:
    delete:
      summary: Delete firewall rule by number
      operationId: delete_firewall_rule
      tags:
        - network
        - firewall
      description: |
        Delete firewall rule by number
        
            **Rate Limit**: 5 requests per 60 seconds
        
            **Parameters**:
            - rule_num: Rule number from list_rules output
            - override_ssh: Set to true to delete SSH rules (DANGEROUS!)
        
            **Warning**: Deleting SSH rules on remote systems can lock you out!
        
            **Returns**: Success message
      parameters:
        - name: rule_num
          in: path
          required: true
          schema:
            type: string
          description: Rule Num
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/status:
    get:
      summary: Get current firewall status and configuration
      operationId: get_firewall_status
      tags:
        - network
        - firewall
      description: |
        Get current firewall status and configuration
        
            **Rate Limit**: 30 requests per 60 seconds
        
            **Returns**:
            - enabled: Whether UFW is active
            - status: Firewall status (active/inactive)
            - default_policy: Default policies for incoming/outgoing/routed traffic
            - total_rules: Total number of configured rules
            - active_rules: Number of active rules
            - ipv6_enabled: Whether IPv6 is enabled
            - logging: Logging level
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/templates:
    get:
      summary: List all available firewall rule templates
      operationId: list_firewall_templates
      tags:
        - network
        - firewall
      description: |
        List all available firewall rule templates
        
            **Rate Limit**: 20 requests per 60 seconds
        
            **Returns**: List of available templates with descriptions
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/network/firewall/templates/{template_name}:
    post:
      summary: Apply predefined firewall rule template
      operationId: apply_firewall_template
      tags:
        - network
        - firewall
      description: |
        Apply predefined firewall rule template
        
            **Rate Limit**: 5 requests per 60 seconds
        
            **Available Templates**:
            - web-server: HTTP (80), HTTPS (443)
            - database: MySQL (3306), PostgreSQL (5432), MongoDB (27017)
            - docker: Docker daemon (2375, 2376)
            - development: Common dev ports (3000, 8000, 8080, 5000)
            - mail-server: SMTP (25, 587), IMAP (143, 993), POP3 (110, 995)
        
            **Parameters**:
            - template_name: Name of template to apply
            - override_existing: Replace existing rules (default: false)
        
            **Returns**: Success message with list of added rules
      parameters:
        - name: template_name
          in: path
          required: true
          schema:
            type: string
          description: Template Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/notifications/health:
    get:
      summary: Health check for email notification service
      operationId: notification_health
      tags:
        - Email Notifications
      description: |
        Health check for email notification service
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/notifications/preferences/{user_id}:
    get:
      summary: Get email notification preferences for a user
      operationId: get_notification_preferences
      tags:
        - Email Notifications
      description: |
        Get email notification preferences for a user
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
          description: User Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update email notification preferences for a user
      operationId: update_notification_preferences
      tags:
        - Email Notifications
      description: |
        Update email notification preferences for a user
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
          description: User Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/notifications/send/coupon-redeemed:
    post:
      summary: Manually send coupon redemption confirmation (for testing)
      operationId: send_coupon_redeemed
      tags:
        - Email Notifications
      description: |
        Manually send coupon redemption confirmation (for testing)
        
            Requires admin role.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/notifications/send/low-balance:
    post:
      summary: Manually send low balance alert email (for testing)
      operationId: send_low_balance_alert
      tags:
        - Email Notifications
      description: |
        Manually send low balance alert email (for testing)
        
            Requires admin role.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/notifications/send/monthly-reset:
    post:
      summary: Manually send monthly credit reset notification (for testing)
      operationId: send_monthly_reset
      tags:
        - Email Notifications
      description: |
        Manually send monthly credit reset notification (for testing)
        
            Requires admin role.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/notifications/send/payment-failure:
    post:
      summary: Manually send payment failure alert (for testing)
      operationId: send_payment_failure
      tags:
        - Email Notifications
      description: |
        Manually send payment failure alert (for testing)
        
            Requires admin role.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/notifications/send/tier-upgrade:
    post:
      summary: Manually send tier upgrade notification (for testing)
      operationId: send_tier_upgrade
      tags:
        - Email Notifications
      description: |
        Manually send tier upgrade notification (for testing)
        
            Requires admin role.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/notifications/send/welcome:
    post:
      summary: Manually send welcome email (for testing)
      operationId: send_welcome_email
      tags:
        - Email Notifications
      description: |
        Manually send welcome email (for testing)
        
            Requires admin role.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/notifications/unsubscribe/{user_id}:
    get:
      summary: Unsubscribe user from email notifications (public endpoint)
      operationId: unsubscribe_from_notifications
      tags:
        - Email Notifications
      description: |
        Unsubscribe user from email notifications (public endpoint)
        
            This endpoint is linked in email footers.
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
          description: User Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/org/roles:
    get:
      summary: Get list of available organization roles
      operationId: list_available_roles
      tags:
        - organizations
      description: |
        Get list of available organization roles
        
            Returns:
                List of roles with descriptions and permissions
        
            Example:
                GET /api/v1/org/roles
                Response: {
                    "roles": [
                        {
                            "id": "owner",
                            "name": "Owner",
                            "description": "Full organization control",
                            "permissions": ["manage_members", "manage_billing", "manage_settings", "delete_org"]
                        },
                        ...
                    ]
                }
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/org/{org_id}/billing:
    get:
      summary: Get organization billing information
      operationId: get_organization_billing
      tags:
        - organizations
      description: |
        Get organization billing information
        
            Args:
                org_id: Organization ID
        
            Returns:
                Billing information including Lago and Stripe customer IDs
        
            Example:
                GET /api/v1/org/org_12345/billing
                Response: {
                    "plan_tier": "professional",
                    "lago_customer_id": "lago_cust_abc123",
                    "stripe_customer_id": "cus_xyz789",
                    "status": "active"
                }
      parameters:
        - name: org_id
          in: path
          required: true
          schema:
            type: string
          description: Org Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/org/{org_id}/members:
    get:
      summary: Get list of all members in an organization
      operationId: list_organization_members
      tags:
        - organizations
      description: |
        Get list of all members in an organization
        
            Args:
                org_id: Organization ID
        
            Returns:
                List of organization members with roles and join dates
        
            Example:
                GET /api/v1/org/org_12345/members
                Response: {
                    "members": [
                        {
                            "user_id": "user@example.com",
                            "role": "owner",
                            "joined_at": "2025-01-15T10:30:00Z"
                        },
                        ...
                    ],
                    "total": 5
                }
      parameters:
        - name: org_id
          in: path
          required: true
          schema:
            type: string
          description: Org Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Add a new member to the organization
      operationId: add_organization_member
      tags:
        - organizations
      description: |
        Add a new member to the organization
        
            Args:
                org_id: Organization ID
                member_data: User ID and role to assign
        
            Returns:
                Success confirmation
        
            Example:
                POST /api/v1/org/org_12345/members
                Body: {"user_id": "newuser@example.com", "role": "member"}
                Response: {
                    "success": true,
                    "message": "User added to organization",
                    "user_id": "newuser@example.com",
                    "role": "member"
                }
      parameters:
        - name: org_id
          in: path
          required: true
          schema:
            type: string
          description: Org Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/org/{org_id}/members/{user_id}:
    delete:
      summary: Remove a member from the organization
      operationId: remove_organization_member
      tags:
        - organizations
      description: |
        Remove a member from the organization
        
            Args:
                org_id: Organization ID
                user_id: User ID to remove
        
            Returns:
                Success confirmation
        
            Example:
                DELETE /api/v1/org/org_12345/members/user@example.com
                Response: {
                    "success": true,
                    "message": "User removed from organization",
                    "user_id": "user@example.com"
                }
      parameters:
        - name: org_id
          in: path
          required: true
          schema:
            type: string
          description: Org Id
        - name: user_id
          in: path
          required: true
          schema:
            type: string
          description: User Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/org/{org_id}/members/{user_id}/role:
    put:
      summary: Update a member's role in the organization
      operationId: update_member_role
      tags:
        - organizations
      description: |
        Update a member's role in the organization
        
            Args:
                org_id: Organization ID
                user_id: User ID to update
                role_data: New role to assign
        
            Returns:
                Success confirmation
        
            Example:
                PUT /api/v1/org/org_12345/members/user@example.com/role
                Body: {"role": "billing_admin"}
                Response: {
                    "success": true,
                    "message": "User role updated",
                    "user_id": "user@example.com",
                    "new_role": "billing_admin"
                }
      parameters:
        - name: org_id
          in: path
          required: true
          schema:
            type: string
          description: Org Id
        - name: user_id
          in: path
          required: true
          schema:
            type: string
          description: User Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/org/{org_id}/settings:
    get:
      summary: Get organization settings
      operationId: get_organization_settings
      tags:
        - organizations
      description: |
        Get organization settings
        
            Args:
                org_id: Organization ID
        
            Returns:
                Organization settings and configuration
        
            Example:
                GET /api/v1/org/org_12345/settings
                Response: {
                    "id": "org_12345",
                    "name": "Acme Corp",
                    "plan_tier": "professional",
                    "status": "active",
                    "created_at": "2025-01-01T00:00:00Z",
                    "settings": {}
                }
      parameters:
        - name: org_id
          in: path
          required: true
          schema:
            type: string
          description: Org Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update organization settings
      operationId: update_organization_settings
      tags:
        - organizations
      description: |
        Update organization settings
        
            Args:
                org_id: Organization ID
                settings_data: Settings to update
        
            Returns:
                Updated settings
        
            Example:
                PUT /api/v1/org/org_12345/settings
                Body: {"settings": {"notification_email": "admin@acme.com"}}
                Response: {
                    "success": true,
                    "message": "Settings updated",
                    "settings": {"notification_email": "admin@acme.com"}
                }
      parameters:
        - name: org_id
          in: path
          required: true
          schema:
            type: string
          description: Org Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/org/{org_id}/stats:
    get:
      summary: Get organization statistics and metrics
      operationId: get_organization_stats
      tags:
        - organizations
      description: |
        Get organization statistics and metrics
        
            Args:
                org_id: Organization ID
        
            Returns:
                Organization statistics including member counts, activity, etc.
        
            Example:
                GET /api/v1/org/org_12345/stats
                Response: {
                    "total_members": 5,
                    "members_by_role": {"owner": 1, "billing_admin": 1, "member": 3},
                    "created_at": "2025-01-01T00:00:00Z",
                    "plan_tier": "professional",
                    "status": "active"
                }
      parameters:
        - name: org_id
          in: path
          required: true
          schema:
            type: string
          description: Org Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/platform/settings:
    get:
      summary: Get all platform settings with masked secrets
      operationId: get_platform_settings
      tags:
        - Platform Settings
      description: |
        Get all platform settings with masked secrets
        
            **Permissions**: Admin only
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update platform settings
      operationId: update_platform_settings
      tags:
        - Platform Settings
      description: |
        Update platform settings
        
            **Process**:
            1. Validate all provided settings exist
            2. Update docker-compose.direct.yml file
            3. Optionally restart container to apply changes
        
            **Permissions**: Admin only
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/platform/settings/restart:
    post:
      summary: Restart ops-center container to apply new settings
      operationId: restart_container
      tags:
        - Platform Settings
      description: |
        Restart ops-center container to apply new settings
        
            **Warning**: This will cause brief downtime (5-10 seconds)
            **Permissions**: Admin only
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/platform/settings/test:
    post:
      summary: Test connection with provided credentials
      operationId: test_connection
      tags:
        - Platform Settings
      description: |
        Test connection with provided credentials
        
            **Supported Categories**:
            - stripe: Tests Stripe API connectivity
            - lago: Tests Lago API connectivity
            - keycloak: Tests Keycloak admin API
            - cloudflare: Tests Cloudflare API
            - namecheap: Tests NameCheap API
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/platform/settings/{key}:
    get:
      summary: Get specific platform setting
      operationId: get_setting
      tags:
        - Platform Settings
      description: |
        Get specific platform setting
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          description: Key
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/rate-limit/check:
    get:
      summary: Check current rate limit status for user.
      operationId: check_rate_limit
      tags:
        - tier-check
      description: |
        Check current rate limit status for user.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/services/access-matrix:
    get:
      summary: Get complete service access matrix for a given tier.
      operationId: get_access_matrix
      tags:
        - tier-check
      description: |
        Get complete service access matrix for a given tier.
        
            Useful for frontend to display available services.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/storage/cleanup:
    post:
      summary: Clean up unused volumes, images, logs, and cache
      operationId: cleanup_storage
      tags:
        - Storage & Backup
      description: |
        Clean up unused volumes, images, logs, and cache
        
            **Admin only** - Performs storage cleanup operations
        
            - **cleanup_docker**: Remove unused Docker volumes and images
            - **cleanup_logs**: Compress and remove old log files
            - **cleanup_cache**: Clear Redis and temporary caches
            - **cleanup_backups**: Remove backups beyond retention period
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/storage/health:
    get:
      summary: Check storage health and get recommendations
      operationId: check_storage_health
      tags:
        - Storage & Backup
      description: |
        Check storage health and get recommendations
        
            Returns:
            - Overall health status
            - Disk usage percentage
            - Volume health summary
            - Recommendations for improvements
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/storage/info:
    get:
      summary: Get comprehensive storage information
      operationId: get_storage_info
      tags:
        - Storage & Backup
      description: |
        Get comprehensive storage information
        
            - **total_space**: Total disk space in bytes
            - **used_space**: Used disk space in bytes
            - **free_space**: Free disk space in bytes
            - **volumes**: List of all volumes with details
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/storage/optimize:
    post:
      summary: Optimize storage (compress logs, verify integrity)
      operationId: optimize_storage
      tags:
        - Storage & Backup
      description: |
        Optimize storage (compress logs, verify integrity)
        
            **Admin only** - Performs storage optimization operations
        
            - **compress_logs**: Compress log files to save space
            - **defragment**: Defragment volumes (if filesystem supports it)
            - **verify_integrity**: Verify file integrity checksums
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/storage/volumes:
    get:
      summary: List all Docker volumes with details
      operationId: list_volumes
      tags:
        - Storage & Backup
      description: |
        List all Docker volumes with details
        
            Returns detailed information about each volume:
            - Name and path
            - Size and type
            - Health status
            - Last accessed time
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/storage/volumes/{volume_name}:
    get:
      summary: Get detailed information about a specific volume
      operationId: get_volume_details
      tags:
        - Storage & Backup
      description: |
        Get detailed information about a specific volume
        
            - **volume_name**: Name of the volume to inspect
        
            Returns:
            - Volume metadata
            - File count and largest files
            - Health status and recommendations
      parameters:
        - name: volume_name
          in: path
          required: true
          schema:
            type: string
          description: Volume Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/admin/user-access/{user_id}:
    get:
      summary: Get service access for specific user (admin only)
      operationId: get_user_access_admin
      tags:
        - subscriptions
      description: |
        Get service access for specific user (admin only)
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
          description: User Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/cancel:
    post:
      summary: Cancel current subscription.
      operationId: cancel_subscription
      tags:
        - subscriptions
      description: |
        Cancel current subscription.
            Access continues until end of billing period.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/change:
    post:
      summary: Change subscription to a different tier (usually downgrade).
      operationId: change_subscription
      tags:
        - subscriptions
      description: |
        Change subscription to a different tier (usually downgrade).
            Takes effect at end of current billing period.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/check-access/{service}:
    post:
      summary: Check if user has access to specific service
      operationId: check_service_access
      tags:
        - subscriptions
      description: |
        Check if user has access to specific service
      parameters:
        - name: service
          in: path
          required: true
          schema:
            type: string
          description: Service
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/confirm-upgrade:
    post:
      summary: Confirm upgrade after successful Stripe payment.
      operationId: confirm_upgrade
      tags:
        - subscriptions
      description: |
        Confirm upgrade after successful Stripe payment.
            Called by webhook or redirect after checkout.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/current:
    get:
      summary: Get current subscription details from Lago.
      operationId: get_current_subscription
      tags:
        - subscriptions
      description: |
        Get current subscription details from Lago.
            Returns subscription status, plan details, and next billing date.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/downgrade:
    post:
      summary: Schedule subscription downgrade at end of current billing period.
      operationId: initiate_downgrade
      tags:
        - subscriptions
      description: |
        Schedule subscription downgrade at end of current billing period.
            No immediate payment required.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/my-access:
    get:
      summary: Get services accessible to current user
      operationId: get_my_access
      tags:
        - subscriptions
      description: |
        Get services accessible to current user
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/plans:
    get:
      summary: Get all active subscription plans
      operationId: get_plans
      tags:
        - subscriptions
      description: |
        Get all active subscription plans
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Create new subscription plan (admin only)
      operationId: create_plan
      tags:
        - subscriptions
      description: |
        Create new subscription plan (admin only)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/plans/{plan_id}:
    get:
      summary: Get specific plan details
      operationId: get_plan
      tags:
        - subscriptions
      description: |
        Get specific plan details
      parameters:
        - name: plan_id
          in: path
          required: true
          schema:
            type: string
          description: Plan Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update subscription plan (admin only)
      operationId: update_plan
      tags:
        - subscriptions
      description: |
        Update subscription plan (admin only)
      parameters:
        - name: plan_id
          in: path
          required: true
          schema:
            type: string
          description: Plan Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete (deactivate) subscription plan (admin only)
      operationId: delete_plan
      tags:
        - subscriptions
      description: |
        Delete (deactivate) subscription plan (admin only)
      parameters:
        - name: plan_id
          in: path
          required: true
          schema:
            type: string
          description: Plan Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/preview-change:
    get:
      summary: Preview subscription change with proration calculation.
      operationId: preview_subscription_change
      tags:
        - subscriptions
      description: |
        Preview subscription change with proration calculation.
            Shows amount to charge (upgrade) or credit (downgrade).
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/services:
    get:
      summary: Get all available services (for admin reference)
      operationId: get_all_services
      tags:
        - subscriptions
      description: |
        Get all available services (for admin reference)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/subscriptions/upgrade:
    post:
      summary: Upgrade subscription to a higher tier.
      operationId: upgrade_subscription
      tags:
        - subscriptions
      description: |
        Upgrade subscription to a higher tier.
            Creates Stripe checkout session and redirects user to payment.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Initiate subscription upgrade flow with Stripe Checkout.
      operationId: initiate_upgrade
      tags:
        - subscriptions
      description: |
        Initiate subscription upgrade flow with Stripe Checkout.
            Upgrades apply immediately with proration.
        
            Returns Stripe Checkout session URL for payment.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/alerts:
    get:
      summary: Get active system alerts and warnings.
      operationId: get_system_alerts
      tags:
        - system-metrics
      description: |
        Get active system alerts and warnings.
        
            Alert types:
            - high_cpu: CPU usage above threshold
            - low_memory: Low available memory
            - low_disk: Low disk space
            - service_down: Docker container stopped
            - service_unhealthy: Container health check failed
            - high_temperature: Temperature above safe levels
            - network_errors: Network error rate elevated
            - swap_usage_high: High swap usage
            - disk_io_high: High disk I/O activity
            - backup_failed: Backup operation failed
            - security_warning: Security-related alert
        
            Returns:
                List of active alerts with severity, message, and details
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/alerts/history:
    get:
      summary: Get alert history.
      operationId: get_alert_history
      tags:
        - system-metrics
      description: |
        Get alert history.
        
            Args:
                limit: Maximum number of alerts to return (1-500)
                severity: Filter by severity level (optional)
        
            Returns:
                List of historical alerts
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/alerts/summary:
    get:
      summary: Get summary of current alerts by severity.
      operationId: get_alert_summary
      tags:
        - system-metrics
      description: |
        Get summary of current alerts by severity.
        
            Returns:
                Alert counts broken down by severity level
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/alerts/{alert_id}/dismiss:
    post:
      summary: Dismiss a system alert.
      operationId: dismiss_alert
      tags:
        - system-metrics
      description: |
        Dismiss a system alert.
        
            Args:
                alert_id: Alert ID to dismiss
        
            Returns:
                Success status
      parameters:
        - name: alert_id
          in: path
          required: true
          schema:
            type: string
          description: Alert Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/health-score:
    get:
      summary: Calculate overall system health score (0-100).
      operationId: get_health_score
      tags:
        - system-metrics
      description: |
        Calculate overall system health score (0-100).
        
            The health score is calculated using weighted components:
            - CPU health: 30%
            - Memory health: 25%
            - Disk health: 20%
            - Services health: 15%
            - Network health: 10%
        
            Returns:
                Overall health score with component breakdown and recommendations
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/keycloak/api-credentials:
    get:
      summary: Get service account credentials for Ops-Center API
      operationId: get_api_credentials
      tags:
        - keycloak-status
      description: |
        Get service account credentials for Ops-Center API
        
            NOTE: This endpoint should be admin-only!
            Returns sensitive credential information.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/keycloak/clients:
    get:
      summary: List OAuth clients configured in Keycloak
      operationId: get_clients
      tags:
        - keycloak-status
      description: |
        List OAuth clients configured in Keycloak
        
            Returns:
                List of OAuth clients with their configuration
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/keycloak/session-config:
    get:
      summary: Get session configuration from Keycloak realm settings
      operationId: get_session_config
      tags:
        - keycloak-status
      description: |
        Get session configuration from Keycloak realm settings
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/keycloak/ssl-status:
    get:
      summary: Get SSL/TLS certificate status for Keycloak
      operationId: get_ssl_status
      tags:
        - keycloak-status
      description: |
        Get SSL/TLS certificate status for Keycloak
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/keycloak/status:
    get:
      summary: Get Keycloak service status and configuration
      operationId: get_keycloak_status
      tags:
        - keycloak-status
      description: |
        Get Keycloak service status and configuration
        
            Returns:
                - Service status (running/stopped)
                - Realm information
                - User count
                - Active sessions
                - Configured identity providers
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/keycloak/test-connection:
    post:
      summary: Test connection to Keycloak and verify admin credentials
      operationId: test_keycloak_connection
      tags:
        - keycloak-status
      description: |
        Test connection to Keycloak and verify admin credentials
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/metrics:
    get:
      summary: Get comprehensive system metrics with historical data.
      operationId: get_system_metrics
      tags:
        - system-metrics
      description: |
        Get comprehensive system metrics with historical data.
        
            Returns real-time CPU, memory, disk, network, and GPU metrics
            along with historical trend data for the specified timeframe.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/processes:
    get:
      summary: Get top processes by CPU and memory usage.
      operationId: get_top_processes
      tags:
        - system-metrics
      description: |
        Get top processes by CPU and memory usage.
        
            Args:
                limit: Number of processes to return (1-50)
        
            Returns:
                Top processes sorted by resource usage
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/services/status:
    get:
      summary: Get status of all Docker services.
      operationId: get_services_status
      tags:
        - system-metrics
      description: |
        Get status of all Docker services.
        
            Returns detailed information about each Docker container including
            resource usage, health status, and uptime.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/settings/audit/log:
    get:
      summary: Get audit log for system settings changes
      operationId: get_audit_log
      tags:
        - System Settings
      description: |
        Get audit log for system settings changes
        
            Query params:
            - key: Filter by setting key (optional)
            - limit: Maximum number of entries (default: 100, max: 1000)
            - offset: Offset for pagination (default: 0)
        
            Admin only. Returns all changes with user, timestamp, and IP address.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/settings/bulk:
    post:
      summary: Bulk update multiple settings
      operationId: bulk_update_settings
      tags:
        - System Settings
      description: |
        Bulk update multiple settings
        
            Updates multiple settings in a single transaction.
            Settings that don't exist will be skipped.
        
            Request body:
            ```json
            {
                "settings": [
                    {"key": "SMTP_HOST", "value": "smtp.office365.com"},
                    {"key": "SMTP_PORT", "value": "587"},
                    {"key": "LOG_LEVEL", "value": "DEBUG"}
                ]
            }
            ```
        
            Admin only. All changes are audited individually.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/settings/categories:
    get:
      summary: List all available setting categories
      operationId: list_categories
      tags:
        - System Settings
      description: |
        List all available setting categories
        
            Returns list of categories with descriptions.
            Public endpoint (no auth required).
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/settings/health:
    get:
      summary: Health check endpoint
      operationId: health_check
      tags:
        - System Settings
      description: |
        Health check endpoint
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/settings/{key}:
    get:
      summary: Get specific setting by key
      operationId: get_setting
      tags:
        - System Settings
      description: |
        Get specific setting by key
        
            Query params:
            - show_value: Whether to show decrypted value (default: false, masked)
        
            Admin only. Sensitive values are masked by default.
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          description: Key
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update existing setting
      operationId: update_setting
      tags:
        - System Settings
      description: |
        Update existing setting
        
            Updates only the provided fields. Key must already exist.
            Admin only. All changes are audited.
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          description: Key
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a system setting
      operationId: delete_setting
      tags:
        - System Settings
      description: |
        Delete a system setting
        
            Deletes setting if it exists and is editable/not required.
            Admin only. All deletions are audited.
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          description: Key
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/system/temperature:
    get:
      summary: Get system temperature sensors.
      operationId: get_system_temperature
      tags:
        - system-metrics
      description: |
        Get system temperature sensors.
        
            Returns temperature readings from all available sensors.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/tiers/info:
    get:
      summary: Get information about all subscription tiers.
      operationId: get_tiers_info
      tags:
        - tier-check
      description: |
        Get information about all subscription tiers.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/acme/status:
    get:
      summary: Get ACME (Let's Encrypt) status
      operationId: get_acme_status
      tags:
        - traefik
      description: |
        Get ACME (Let's Encrypt) status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/certificates:
    get:
      summary: List all SSL certificates
      operationId: list_certificates
      tags:
        - traefik
      description: |
        List all SSL certificates
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/certificates/{domain}:
    get:
      summary: Get SSL certificate information for a domain
      operationId: get_certificate
      tags:
        - traefik
      description: |
        Get SSL certificate information for a domain
      parameters:
        - name: domain
          in: path
          required: true
          schema:
            type: string
          description: Domain
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/config/reload:
    post:
      summary: Reload Traefik configuration
      operationId: reload_config
      tags:
        - traefik
      description: |
        Reload Traefik configuration
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/config/summary:
    get:
      summary: Get Traefik configuration summary
      operationId: get_config_summary
      tags:
        - traefik
      description: |
        Get Traefik configuration summary
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/config/validate:
    post:
      summary: Validate Traefik configuration
      operationId: validate_config
      tags:
        - traefik
      description: |
        Validate Traefik configuration
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/health:
    get:
      summary: Health check endpoint for Traefik management API
      operationId: health_check
      tags:
        - traefik
      description: |
        Health check endpoint for Traefik management API
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/metrics/errors:
    get:
      summary: Get error summary across all routes.
      operationId: get_error_summary
      tags:
        - Traefik Metrics
      description: |
        Get error summary across all routes.
        
            Returns:
                Error summary
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/metrics/overview:
    get:
      summary: Get overall Traefik statistics.
      operationId: get_traefik_stats
      tags:
        - Traefik Metrics
      description: |
        Get overall Traefik statistics.
        
            Returns:
                Traefik stats
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/metrics/performance:
    get:
      summary: Get performance summary across all routes.
      operationId: get_performance_summary
      tags:
        - Traefik Metrics
      description: |
        Get performance summary across all routes.
        
            Returns:
                Performance summary
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/metrics/raw:
    get:
      summary: Get raw Prometheus metrics from Traefik.
      operationId: get_raw_metrics
      tags:
        - Traefik Metrics
      description: |
        Get raw Prometheus metrics from Traefik.
        
            Returns:
                Raw metrics text
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/metrics/routes:
    get:
      summary: Get metrics for all routes.
      operationId: get_route_metrics
      tags:
        - Traefik Metrics
      description: |
        Get metrics for all routes.
        
            Returns:
                List of route metrics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/metrics/routes/{route_name}:
    get:
      summary: Get metrics for a specific route.
      operationId: get_route_metric
      tags:
        - Traefik Metrics
      description: |
        Get metrics for a specific route.
        
            Args:
                route_name: Route name
        
            Returns:
                Route metrics
      parameters:
        - name: route_name
          in: path
          required: true
          schema:
            type: string
          description: Route Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/middlewares:
    get:
      summary: List all Traefik middlewares
      operationId: list_middlewares
      tags:
        - traefik
      description: |
        List all Traefik middlewares
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Create a new Traefik middleware
      operationId: create_middleware
      tags:
        - traefik
      description: |
        Create a new Traefik middleware
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/middlewares/templates:
    get:
      summary: List available middleware templates.
      operationId: list_middleware_templates
      tags:
        - Traefik Middlewares
      description: |
        List available middleware templates.
        
            Returns:
                List of middleware templates
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/middlewares/{middleware_id}:
    get:
      summary: Get specific middleware details.
      operationId: get_middleware
      tags:
        - Traefik Middlewares
      description: |
        Get specific middleware details.
        
            Args:
                middleware_id: Middleware name
        
            Returns:
                Middleware information
      parameters:
        - name: middleware_id
          in: path
          required: true
          schema:
            type: string
          description: Middleware Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update an existing middleware.
      operationId: update_middleware
      tags:
        - Traefik Middlewares
      description: |
        Update an existing middleware.
        
            Args:
                middleware_id: Middleware name
                middleware: Updated middleware configuration
        
            Returns:
                Updated middleware information
      parameters:
        - name: middleware_id
          in: path
          required: true
          schema:
            type: string
          description: Middleware Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a middleware.
      operationId: delete_middleware
      tags:
        - Traefik Middlewares
      description: |
        Delete a middleware.
        
            Args:
                middleware_id: Middleware name
        
            Returns:
                Success message
      parameters:
        - name: middleware_id
          in: path
          required: true
          schema:
            type: string
          description: Middleware Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/middlewares/{middleware_name}:
    get:
      summary: Get details of a specific middleware
      operationId: get_middleware
      tags:
        - traefik
      description: |
        Get details of a specific middleware
      parameters:
        - name: middleware_name
          in: path
          required: true
          schema:
            type: string
          description: Middleware Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update an existing middleware
      operationId: update_middleware
      tags:
        - traefik
      description: |
        Update an existing middleware
      parameters:
        - name: middleware_name
          in: path
          required: true
          schema:
            type: string
          description: Middleware Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a Traefik middleware
      operationId: delete_middleware
      tags:
        - traefik
      description: |
        Delete a Traefik middleware
      parameters:
        - name: middleware_name
          in: path
          required: true
          schema:
            type: string
          description: Middleware Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/routes:
    get:
      summary: List all Traefik routes
      operationId: list_routes
      tags:
        - traefik
      description: |
        List all Traefik routes
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Create a new Traefik route
      operationId: create_route
      tags:
        - traefik
      description: |
        Create a new Traefik route
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/routes/{route_id}:
    get:
      summary: Get specific route details.
      operationId: get_route
      tags:
        - Traefik Routes
      description: |
        Get specific route details.
        
            Args:
                route_id: Route name
        
            Returns:
                Route information
      parameters:
        - name: route_id
          in: path
          required: true
          schema:
            type: string
          description: Route Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update an existing Traefik route.
      operationId: update_route
      tags:
        - Traefik Routes
      description: |
        Update an existing Traefik route.
        
            Args:
                route_id: Route name
                route: Updated route configuration
        
            Returns:
                Updated route information
      parameters:
        - name: route_id
          in: path
          required: true
          schema:
            type: string
          description: Route Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a Traefik route.
      operationId: delete_route
      tags:
        - Traefik Routes
      description: |
        Delete a Traefik route.
        
            Args:
                route_id: Route name
        
            Returns:
                Success message
      parameters:
        - name: route_id
          in: path
          required: true
          schema:
            type: string
          description: Route Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/routes/{route_id}/test:
    post:
      summary: Test a Traefik route configuration.
      operationId: test_route
      tags:
        - Traefik Routes
      description: |
        Test a Traefik route configuration.
        
            Args:
                route_id: Route name
        
            Returns:
                Test result
      parameters:
        - name: route_id
          in: path
          required: true
          schema:
            type: string
          description: Route Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/routes/{route_name}:
    get:
      summary: Get details of a specific route
      operationId: get_route
      tags:
        - traefik
      description: |
        Get details of a specific route
      parameters:
        - name: route_name
          in: path
          required: true
          schema:
            type: string
          description: Route Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update an existing route
      operationId: update_route
      tags:
        - traefik
      description: |
        Update an existing route
      parameters:
        - name: route_name
          in: path
          required: true
          schema:
            type: string
          description: Route Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a Traefik route
      operationId: delete_route
      tags:
        - traefik
      description: |
        Delete a Traefik route
      parameters:
        - name: route_name
          in: path
          required: true
          schema:
            type: string
          description: Route Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/services:
    get:
      summary: List all Traefik services
      operationId: list_services
      tags:
        - traefik
      description: |
        List all Traefik services
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    post:
      summary: Create a new Traefik service
      operationId: create_service
      tags:
        - traefik
      description: |
        Create a new Traefik service
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/services/discover/containers:
    get:
      summary: Discover running Docker containers for service creation.
      operationId: discover_containers
      tags:
        - Traefik Services
      description: |
        Discover running Docker containers for service creation.
        
            Returns:
                List of discovered containers
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/services/{service_id}:
    get:
      summary: Get specific service details.
      operationId: get_service
      tags:
        - Traefik Services
      description: |
        Get specific service details.
        
            Args:
                service_id: Service name
        
            Returns:
                Service information
      parameters:
        - name: service_id
          in: path
          required: true
          schema:
            type: string
          description: Service Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    put:
      summary: Update an existing backend service.
      operationId: update_service
      tags:
        - Traefik Services
      description: |
        Update an existing backend service.
        
            Args:
                service_id: Service name
                service: Updated service configuration
        
            Returns:
                Updated service information
      parameters:
        - name: service_id
          in: path
          required: true
          schema:
            type: string
          description: Service Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a backend service.
      operationId: delete_service
      tags:
        - Traefik Services
      description: |
        Delete a backend service.
        
            Args:
                service_id: Service name
        
            Returns:
                Success message
      parameters:
        - name: service_id
          in: path
          required: true
          schema:
            type: string
          description: Service Id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/services/{service_name}:
    get:
      summary: Get details of a specific service
      operationId: get_service
      tags:
        - traefik
      description: |
        Get details of a specific service
      parameters:
        - name: service_name
          in: path
          required: true
          schema:
            type: string
          description: Service Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
    delete:
      summary: Delete a Traefik service
      operationId: delete_service
      tags:
        - traefik
      description: |
        Delete a Traefik service
      parameters:
        - name: service_name
          in: path
          required: true
          schema:
            type: string
          description: Service Name
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/traefik/status:
    get:
      summary: Get overall Traefik status
      operationId: get_traefik_status
      tags:
        - traefik
      description: |
        Get overall Traefik status
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/usage/current:
    get:
      summary: Get current usage statistics for the authenticated user.
      operationId: get_current_usage_endpoint
      tags:
        - usage
      description: |
        Get current usage statistics for the authenticated user.
            Integrates data from both Keycloak (tier) and Lago (metered usage).
        
            Returns tier info, usage counts, limits, and service breakdown.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/usage/export:
    get:
      summary: Export usage data as CSV file.
      operationId: export_usage_data
      tags:
        - usage
      description: |
        Export usage data as CSV file.
        
            Args:
                period: Time period for export (week, month, year)
        
            Returns:
                CSV file with usage statistics
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/usage/features:
    get:
      summary: Get feature access information for current tier.
      operationId: get_tier_features
      tags:
        - usage
      description: |
        Get feature access information for current tier.
        
            Returns which features are available and which require upgrade.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/usage/history:
    get:
      summary: Get historical usage data.
      operationId: get_usage_history
      tags:
        - usage
      description: |
        Get historical usage data.
        
            Args:
                days: Number of days of history to return (default: 30)
        
            Note: This endpoint is a placeholder. Full implementation requires
            storing historical usage data in a time-series database.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/usage/limits:
    get:
      summary: Get tier limits and pricing information.
      operationId: get_tier_limits
      tags:
        - usage
      description: |
        Get tier limits and pricing information.
        
            Returns limits for all tiers for comparison.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/usage/reset-demo:
    post:
      summary: DEMO/TESTING ONLY: Reset usage counter for current user.
      operationId: reset_usage_demo
      tags:
        - usage
      description: |
        DEMO/TESTING ONLY: Reset usage counter for current user.
        
            This endpoint should be disabled in production or protected with admin auth.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/usage/track:
    post:
      summary: Track service usage for billing and rate limiting.
      operationId: track_usage
      tags:
        - tier-check
      description: |
        Track service usage for billing and rate limiting.
        
            This endpoint is called by services to log usage events.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error
  /api/v1/user/tier:
    get:
      summary: Get user's subscription tier information.
      operationId: get_user_tier_info
      tags:
        - tier-check
      description: |
        Get user's subscription tier information.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - Insufficient permissions
        '404':
          description: Resource not found
        '500':
          description: Internal server error

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from Keycloak SSO authentication.

        To obtain a token:
        1. Navigate to https://auth.your-domain.com
        2. Login with credentials or OAuth provider (Google, GitHub, Microsoft)
        3. Retrieve access_token from response
        4. Include in Authorization header: `Bearer <token>`

  schemas:
    Error:
      type: object
      required:
        - detail
      properties:
        detail:
          type: string
          description: Error message
        status_code:
          type: integer
          description: HTTP status code

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User ID (Keycloak UUID)
        email:
          type: string
          format: email
          description: User email address
        username:
          type: string
          description: Username
        roles:
          type: array
          items:
            type: string
          description: User roles (admin, moderator, developer, analyst, viewer)
        subscription_tier:
          type: string
          enum: [trial, starter, professional, enterprise]
          description: Current subscription tier
        subscription_status:
          type: string
          enum: [active, suspended, cancelled]
          description: Subscription status
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp

    Organization:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Organization ID
        name:
          type: string
          description: Organization name
        owner_id:
          type: string
          format: uuid
          description: Owner user ID
        member_count:
          type: integer
          description: Number of members
        subscription_tier:
          type: string
          enum: [trial, starter, professional, enterprise]
          description: Organization subscription tier
        created_at:
          type: string
          format: date-time
          description: Creation timestamp

    Subscription:
      type: object
      properties:
        id:
          type: string
          description: Subscription ID (Lago)
        plan_code:
          type: string
          enum: [trial, starter, professional, enterprise]
          description: Plan code
        status:
          type: string
          enum: [active, pending, suspended, cancelled]
          description: Subscription status
        current_period_start:
          type: string
          format: date-time
          description: Current billing period start
        current_period_end:
          type: string
          format: date-time
          description: Current billing period end
        api_calls_limit:
          type: integer
          description: API call limit per period
        api_calls_used:
          type: integer
          description: API calls used in current period
