# UC-Cloud Ops-Center API Documentation

**Version**: 2.1.0
**Total Endpoints**: 310
**Last Updated**: October 25, 2025

Welcome to the UC-Cloud Ops-Center API documentation. This comprehensive documentation suite provides everything you need to integrate with and extend the Ops-Center platform.

---

## Quick Start

### üöÄ For API Consumers

1. **Start Here**: [API Schemas Documentation](./API_SCHEMAS.md)
   - Learn about authentication
   - Understand common patterns
   - See request/response examples

2. **Interactive Testing**: http://localhost:8084/docs
   - Try API calls in your browser
   - Explore all 310 endpoints
   - Test authentication flows

3. **Browse Endpoints**: [API Endpoints Summary](./API_ENDPOINTS_SUMMARY.md)
   - Quick reference of all endpoints
   - Grouped by category
   - Includes path parameters

4. **Download Spec**: [openapi.yaml](./openapi.yaml)
   - Use with code generation tools
   - Import to Postman/Insomnia
   - Full OpenAPI 3.0 specification

### üõ†Ô∏è For API Developers

1. **Read**: [OpenAPI Integration Guide](./OPENAPI_INTEGRATION_GUIDE.md)
   - Documentation maintenance
   - Code generation setup
   - Testing strategies

2. **Extend**: Add new endpoints
   - Create route in `backend/*_api.py`
   - Add docstring for description
   - Run: `python3 scripts/simple_endpoint_extractor.py`

3. **Enhance**: [openapi_config.py](../backend/openapi_config.py)
   - Customize FastAPI metadata
   - Add new common schemas
   - Update tag descriptions

---

## Documentation Files

### Primary Documentation

| File | Purpose | Size | Format |
|------|---------|------|--------|
| [openapi.yaml](./openapi.yaml) | Complete OpenAPI 3.0 spec | 10,516 lines | YAML |
| [openapi.json](./openapi.json) | Machine-readable spec | ~3000 lines | JSON |
| [API_SCHEMAS.md](./API_SCHEMAS.md) | Detailed schemas + examples | ~800 lines | Markdown |
| [API_ENDPOINTS_SUMMARY.md](./API_ENDPOINTS_SUMMARY.md) | Quick reference | ~400 lines | Markdown |
| [OPENAPI_INTEGRATION_GUIDE.md](./OPENAPI_INTEGRATION_GUIDE.md) | Developer guide | ~400 lines | Markdown |

### Supporting Files

| File | Purpose | Format |
|------|---------|--------|
| [endpoints_data.json](./endpoints_data.json) | Raw endpoint data | JSON |
| [API_DOCUMENTATION_INDEX.md](./API_DOCUMENTATION_INDEX.md) | This file | Markdown |

### Backend Scripts

| File | Purpose | Lines |
|------|---------|-------|
| `backend/scripts/simple_endpoint_extractor.py` | Main doc generator | ~450 |
| `backend/scripts/extract_api_endpoints.py` | AST-based alternative | ~600 |
| `backend/openapi_config.py` | FastAPI enhancements | ~450 |

---

## API Overview

### 310 Endpoints Across 30+ Categories

| Category | Count | Key Features |
|----------|-------|--------------|
| **Storage & Backup** | 25 | Restic backup management, S3/local storage |
| **Traefik** | 22 | Routes, services, middlewares, SSL/TLS |
| **Local Users** | 21 | Linux system user management |
| **Credits** | 21 | Credit system for API usage |
| **Migration** | 20 | Data import/export, bulk operations |
| **LLM Configuration** | 17 | Model settings, provider config |
| **Subscriptions** | 17 | Plan management, billing |
| **Cloudflare** | 16 | DNS, firewall, security |
| **LLM Management** | 13 | LiteLLM routing, failover |
| **Network** | 12 | Firewall rules, IP whitelisting |
| **Email Notifications** | 10 | Email preferences, templates |
| **LLM** | 10 | AI inference (OpenAI-compatible) |
| **Organizations** | 9 | Org management, teams |
| **System Metrics** | 9 | CPU, memory, GPU, disk monitoring |
| **Billing** | 8 | Invoices, payments, Stripe |
| **Admin** | 7 | Admin subscriptions, users |
| **System Settings** | 7 | System configuration |
| **Others** | 37 | Keycloak, tier check, usage, etc. |

### By HTTP Method

- **GET**: 158 endpoints (51%) - Read operations
- **POST**: 100 endpoints (32%) - Create/Execute
- **DELETE**: 28 endpoints (9%) - Delete
- **PUT**: 23 endpoints (7%) - Full updates
- **PATCH**: 1 endpoint (0.3%) - Partial updates

---

## Interactive Documentation

### Swagger UI - `/docs`

**URL**: http://localhost:8084/docs

**Features**:
- ‚ú® Try API calls directly in browser
- üîê Test authentication flows
- üìù View request/response schemas
- üè∑Ô∏è Browse by category
- üîç Search endpoints

**Perfect for**:
- API exploration
- Quick testing
- Learning the API
- Debugging

### ReDoc - `/redoc`

**URL**: http://localhost:8084/redoc

**Features**:
- üìñ Clean three-panel layout
- üîç Full-text search
- üì± Mobile-friendly
- üñ®Ô∏è Print-friendly

**Perfect for**:
- Reading documentation
- Finding specific endpoints
- Sharing with team
- Offline reference

### OpenAPI JSON - `/openapi.json`

**URL**: http://localhost:8084/openapi.json

**Features**:
- ü§ñ Auto-generated by FastAPI
- üîÑ Always up-to-date
- üì¶ Includes Pydantic schemas
- üõ†Ô∏è Code generation ready

**Perfect for**:
- Code generators
- Postman imports
- CI/CD pipelines
- Automation tools

---

## Authentication

All API endpoints require **JWT Bearer token** authentication via Keycloak SSO.

### Getting a Token

1. **Navigate**: https://auth.your-domain.com
2. **Login**: Use credentials or OAuth (Google, GitHub, Microsoft)
3. **Extract**: Get `access_token` from response
4. **Use**: Add to requests:
   ```
   Authorization: Bearer <access_token>
   ```

### Token Details

- **Type**: JWT (JSON Web Token)
- **Issuer**: Keycloak (uchub realm)
- **Expiration**: 15 minutes (access token)
- **Refresh**: 30 days (refresh token)

### Example Request

```bash
curl -X GET \
  https://your-domain.com/api/v1/admin/users \
  -H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
```

---

## Rate Limiting

API requests are rate-limited based on subscription tier.

### Limits by Tier

| Tier | Monthly Limit | Burst Limit | Window |
|------|---------------|-------------|--------|
| Trial | 700 requests | 10/min | 7 days |
| Starter | 1,000 requests | 50/min | 30 days |
| Professional | 10,000 requests | 200/min | 30 days |
| Enterprise | Unlimited | 1000/min | N/A |

### Rate Limit Headers

All responses include:

```
X-RateLimit-Limit: 10000
X-RateLimit-Remaining: 7543
X-RateLimit-Reset: 1730419200
X-RateLimit-Tier: professional
```

### When Limit Exceeded

**Response** (429 Too Many Requests):
```json
{
  "detail": "API call limit exceeded. Upgrade to Professional plan.",
  "status_code": 429,
  "error_code": "RATE_LIMIT_EXCEEDED",
  "retry_after": 3600,
  "current_usage": 1000,
  "limit": 1000,
  "reset_at": "2025-11-01T00:00:00Z"
}
```

---

## Common Use Cases

### 1. User Management

**List all users** (admin only):
```bash
GET /api/v1/admin/users?tier=professional&role=admin
```

**Create user** (admin only):
```bash
POST /api/v1/admin/users/comprehensive
{
  "email": "newuser@example.com",
  "tier": "starter",
  "send_welcome_email": true
}
```

**Bulk import** (admin only):
```bash
POST /api/v1/admin/users/bulk/import
{
  "csv_data": "email,first_name,last_name,tier\nuser@example.com,John,Doe,professional"
}
```

### 2. LLM Inference

**Chat completion** (OpenAI-compatible):
```bash
POST /api/v1/llm/chat/completions
{
  "model": "openai/gpt-4",
  "messages": [
    {"role": "user", "content": "Hello!"}
  ]
}
```

**List models**:
```bash
GET /api/v1/llm/models
```

**Add BYOK** (Bring Your Own Key):
```bash
POST /api/v1/llm/byok/keys
{
  "provider": "openai",
  "api_key": "sk-..."
}
```

### 3. Billing & Subscriptions

**Get current subscription**:
```bash
GET /api/v1/subscriptions/current
```

**View invoices**:
```bash
GET /api/v1/billing/invoices
```

**Upgrade tier**:
```bash
POST /api/v1/subscriptions/upgrade
{
  "plan_code": "professional"
}
```

### 4. Organizations

**Create organization**:
```bash
POST /api/v1/org
{
  "name": "Acme Corp",
  "plan": "enterprise"
}
```

**Add member**:
```bash
POST /api/v1/org/{org_id}/members
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "role": "member"
}
```

### 5. System Monitoring

**Get system metrics**:
```bash
GET /api/v1/system-metrics/current
```

**Get usage analytics**:
```bash
GET /api/v1/analytics/usage?start_date=2025-10-01
```

---

## Code Generation

Generate client SDKs from the OpenAPI specification.

### TypeScript Client

```bash
npx @openapitools/openapi-generator-cli generate \
  -i docs/openapi.yaml \
  -g typescript-fetch \
  -o clients/typescript
```

### Python Client

```bash
openapi-generator-cli generate \
  -i docs/openapi.yaml \
  -g python \
  -o clients/python
```

### Java Client

```bash
openapi-generator-cli generate \
  -i docs/openapi.yaml \
  -g java \
  -o clients/java
```

### Available Generators

Over 50 languages supported:
- JavaScript/TypeScript (fetch, axios, node)
- Python (requests, aiohttp)
- Java (okhttp, retrofit)
- C# (.NET, RestSharp)
- Go (net/http)
- Ruby (Faraday)
- PHP (Guzzle)
- Rust (reqwest)
- And many more...

---

## Testing Tools

### Postman

1. Import OpenAPI spec:
   - File ‚Üí Import ‚Üí Link
   - Paste: `http://localhost:8084/openapi.json`

2. Configure environment:
   - Base URL: `https://your-domain.com`
   - Auth Token: `<your_jwt_token>`

3. Test endpoints

### Insomnia

1. Import OpenAPI spec:
   - Application ‚Üí Import/Export ‚Üí Import Data
   - Select: `docs/openapi.yaml`

2. Configure auth:
   - Header: `Authorization`
   - Value: `Bearer <token>`

3. Run requests

### cURL

```bash
# Set token
TOKEN="eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."

# Test endpoint
curl -H "Authorization: Bearer $TOKEN" \
  https://your-domain.com/api/v1/admin/users
```

---

## Maintenance

### Updating Documentation

When endpoints are added or modified:

```bash
# 1. Edit endpoint in backend/*_api.py
vim backend/org_api.py

# 2. Add/update docstring
"""
Create a new organization

This endpoint creates a new organization with the specified
settings and assigns the current user as owner.
"""

# 3. Regenerate documentation
cd backend
python3 scripts/simple_endpoint_extractor.py

# 4. Review changes
git diff ../docs/openapi.yaml

# 5. Test in browser
open http://localhost:8084/docs

# 6. Commit both code and docs
git add backend/org_api.py docs/
git commit -m "feat: Add organization creation endpoint"
```

### Validation

Check OpenAPI spec validity:

```bash
# Install validator
npm install -g @apidevtools/swagger-cli

# Validate spec
swagger-cli validate docs/openapi.yaml
```

---

## Support

### Documentation Resources

- **API Schemas**: [API_SCHEMAS.md](./API_SCHEMAS.md) - Detailed schemas and examples
- **Quick Reference**: [API_ENDPOINTS_SUMMARY.md](./API_ENDPOINTS_SUMMARY.md) - All endpoints
- **Integration Guide**: [OPENAPI_INTEGRATION_GUIDE.md](./OPENAPI_INTEGRATION_GUIDE.md) - How-to guides
- **Delivery Report**: [OPENAPI_LEAD_DELIVERY_REPORT.md](../OPENAPI_LEAD_DELIVERY_REPORT.md) - Implementation details

### Interactive Docs

- **Swagger UI**: http://localhost:8084/docs
- **ReDoc**: http://localhost:8084/redoc
- **OpenAPI JSON**: http://localhost:8084/openapi.json

### Contact

- **Email**: support@magicunicorn.tech
- **Website**: https://your-domain.com
- **GitHub**: https://github.com/Unicorn-Commander/UC-Cloud

---

## Version History

### v2.1.0 (October 2025)
- ‚ú® Added analytics endpoints (revenue, usage, user)
- ‚ú® Added BYOK (Bring Your Own Key) support
- ‚ú® Added bulk user operations
- ‚ú® Enhanced user detail pages
- üìù Complete OpenAPI 3.0 documentation (310 endpoints)

### v2.0.0 (September 2025)
- ‚ú® Lago billing integration
- ‚ú® Organization management
- ‚ú® Stripe payment processing
- ‚ú® Multi-tenant support

### v1.0.0 (August 2025)
- ‚ú® Initial release
- ‚ú® User management via Keycloak SSO
- ‚ú® LLM inference proxy (LiteLLM)
- ‚ú® Service management

---

## License

MIT License - See [LICENSE](../LICENSE) for details

**Copyright** (c) 2025 Magic Unicorn Unconventional Technology & Stuff Inc

---

**End of API Documentation Index**

**Last Updated**: October 25, 2025
**API Version**: 2.1.0
**Total Endpoints**: 310
